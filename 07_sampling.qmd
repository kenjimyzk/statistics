# 第7回 標本分布 {.unnumbered}

![標本分布](figure/07_sampling/infographic.png)

## 今回の目標

-   母集団と標本の関係を理解する。
-   **大数の法則** と **中心極限定理** をシミュレーションで体感する。
-   標本分布の概念を理解する。

## 母集団と標本

-   **母集団 (Population)**: 知りたい対象全体の集まり（例：日本人全員）。
-   **標本 (Sample)**: 母集団から一部を取り出したもの（例：ランダムに選んだ1000人）。
-   **推測統計**: 標本のデータから、母集団の性質（パラメータ）を推測すること。

### なぜ標本を使うのか

- 母集団全体を調べるのはコストがかかる（全数調査）
- 時間的・物理的に不可能な場合もある
- 少数のサンプルから全体の傾向を推測できる

### 母数と統計量

| 用語 | 説明 | 記号 |
|------|------|------|
| 母平均 | 母集団の平均 | $\mu$ |
| 母分散 | 母集団の分散 | $\sigma^2$ |
| 標本平均 | 標本の平均 | $\bar{x}$ |
| 標本分散 | 標本の分散 | $s^2$ |

### 母集団と標本のイメージ

```{r}
library(tidyverse)
set.seed(1)

# 母集団（例：正規分布） {.unnumbered}
population <- rnorm(10000, mean = 50, sd = 10)

# 標本（そこから100個ランダムに抽出） {.unnumbered}
sample_data <- sample(population, 100)

# データフレーム化 {.unnumbered}
df_pop <- data.frame(value = population, type = "Population")
df_samp <- data.frame(value = sample_data, type = "Sample")
df_all <- bind_rows(df_pop, df_samp)

# ヒストグラムで比較（密度表示） {.unnumbered}
ggplot(df_all, aes(x = value, fill = type)) +
  theme_gray(base_family = "HiraKakuProN-W3") +
  geom_density(alpha = 0.5) +
  labs(title = "母集団と標本の分布比較", x = "値", y = "密度")
```

## 大数の法則 (Law of Large Numbers)

サンプルサイズ（標本の大きさ）$n$ を大きくしていくと、標本平均は母平均に近づいていくという法則です。
サイコロで確かめてみましょう。

```{r}
library(tidyverse)

# サイコロを振る回数を変えて、平均値の推移を見る {.unnumbered}
set.seed(123)
n <- 1000
dice_rolls <- sample(1:6, n, replace = TRUE)
cumulative_mean <- cumsum(dice_rolls) / (1:n)

# データフレーム作成 {.unnumbered}
df <- data.frame(n = 1:n, mean = cumulative_mean)

# プロット {.unnumbered}
ggplot(df, aes(x = n, y = mean)) +
  theme_gray(base_family = "HiraKakuProN-W3") +
  geom_line() +
  geom_hline(yintercept = 3.5, color = "red", linetype = "dashed") +
  labs(title = "大数の法則のシミュレーション", y = "標本平均")
```

回数が増えるにつれて、理論的な期待値 3.5 に近づいていく様子がわかります。

## 中心極限定理 (Central Limit Theorem)

母集団がどんな分布であっても、サンプルサイズ $n$ が十分に大きければ、標本平均の分布は **正規分布** に近づくという強力な定理です。

一様分布（0から1の乱数）から、サイズ $n=30$ の標本を取り出し、その平均を計算する作業を1000回繰り返してみましょう。

```{r}
# シミュレーション {.unnumbered}
n_samples <- 1000
sample_size <- 30
means <- numeric(n_samples)

for (i in 1:n_samples) {
  means[i] <- mean(runif(sample_size, min = 0, max = 1))
}

# ヒストグラム {.unnumbered}
ggplot(data.frame(means), aes(x = means)) +
  theme_gray(base_family = "HiraKakuProN-W3") +
  geom_histogram(bins = 30, fill = "orange", color = "white") +
  labs(title = "標本平均の分布 (n=30)", x = "標本平均")
```

元の分布は平坦（一様分布）ですが、平均値の分布は釣鐘型（正規分布）になっていることが確認できます。

### サンプルサイズによる変化

サンプルサイズを変えて、中心極限定理の効果を確認してみましょう。

```{r}
# 異なるサンプルサイズでのシミュレーション
sample_sizes <- c(5, 30, 100)
n_samples <- 1000

results <- list()
for (n in sample_sizes) {
  means <- replicate(n_samples, mean(runif(n)))
  results[[paste0("n=", n)]] <- means
}

# データフレームにまとめる
df_clt <- data.frame(
  means = unlist(results),
  sample_size = rep(paste0("n=", sample_sizes), each = n_samples)
)

# プロット
ggplot(df_clt, aes(x = means)) +
  theme_gray(base_family = "HiraKakuProN-W3") +
  geom_histogram(bins = 30, fill = "steelblue", color = "white") +
  facet_wrap(~sample_size, scales = "free_y") +
  labs(title = "中心極限定理: サンプルサイズによる変化", x = "標本平均")
```

サンプルサイズが大きくなるほど、分布が正規分布に近づき、ばらつきも小さくなることがわかります。

## 標本平均の分散

標本平均の分散は、母分散をサンプルサイズで割ったものになります。

$$V[\bar{X}] = \frac{\sigma^2}{n}$$

これは、サンプルサイズが大きいほど、標本平均のばらつきが小さくなることを示しています。

```{r}
# 理論値と実際の値を比較
cat("母分散（一様分布）:", 1/12, "\n")
cat("標本平均の理論分散 (n=30):", (1/12) / 30, "\n")
cat("シミュレーションでの分散:", var(results[["n=30"]]), "\n")
```

## 標準誤差 (Standard Error)

標本平均の標準偏差を**標準誤差**といいます。

$$SE = \frac{\sigma}{\sqrt{n}}$$

標準誤差は、推定の精度を表す重要な指標です。

## 課題

1.  中心極限定理のシミュレーションで、`sample_size` を 5 に減らして実行してみてください。ヒストグラムの形はどう変わりますか？

## 練習問題

### 練習1: 大数の法則
コインを投げるシミュレーションを行い、大数の法則を確認してください：
1. `sample(c(0, 1), 1000, replace = TRUE)` でコイン投げをシミュレート
2. 累積の表の割合を計算し、グラフにプロット
3. 回数が増えると0.5に近づくことを確認

### 練習2: 中心極限定理の応用
指数分布（右に歪んだ分布）を使って中心極限定理を確認してください：
1. `rexp(n, rate = 1)` で指数分布から乱数を生成
2. サンプルサイズ30で1000回のシミュレーションを行い、標本平均の分布を描画
3. 正規分布に近づいているか確認

### 練習3: 標準誤差の計算
母平均50、母標準偏差10の正規分布から：
1. サンプルサイズ25のときの標準誤差を計算
2. サンプルサイズ100のときの標準誤差を計算
3. 標準誤差を半分にするには、サンプルサイズを何倍にする必要がありますか？

## まとめ

| 定理 | 内容 | 実務的な意味 |
|------|------|-------------|
| 大数の法則 | $n \to \infty$ で $\bar{X} \to \mu$ | サンプルが多いほど推定が正確 |
| 中心極限定理 | $\bar{X}$ の分布は正規分布に近づく | 正規分布を前提とした推測が可能 |

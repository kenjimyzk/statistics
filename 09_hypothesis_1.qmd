# 第9回 仮説検定 (1) {.unnumbered}

## 今回の目標

-   仮説検定の論理（帰無仮説、対立仮説、p値）を理解する。
-   Rを使って1標本のt検定を行う。

## 仮説検定の考え方

「コインが歪んでいないか？」を確かめたいとします。
「歪んでいない（表が出る確率は0.5）」と仮定したときに、実際に起きたこと（例：10回中9回表）が「めったに起きないこと」かどうかを確率で評価します。

-   **帰無仮説 ($H_0$)**: 否定したい仮説（例：差はない、効果はない）。
-   **対立仮説 ($H_1$)**: 主張したい仮説（例：差がある、効果がある）。
-   **p値 (p-value)**: 帰無仮説が正しいとしたときに、今のデータ（またはそれ以上に極端なデータ）が得られる確率。
-   **有意水準 ($\alpha$)**: 帰無仮説を棄却する基準。通常 0.05 (5%) を使います。

**判定ルール**:
-   p値 < 有意水準 $\Rightarrow$ 帰無仮説を棄却する（統計的に有意である）。
-   p値 $\ge$ 有意水準 $\Rightarrow$ 帰無仮説を棄却できない（差があるとは言えない）。

### 棄却域のイメージ

t分布において、どの範囲に入ったら「極端」とみなされるか（棄却域）を可視化します。

```{r}
library(tidyverse)
theme_set(theme_gray(base_family = "HiraKakuProN-W3"))

# t分布 (自由度9) {.unnumbered}
x <- seq(-4, 4, length.out = 100)
y <- dt(x, df = 9)
df_t <- data.frame(x, y)

# 棄却域 (両側5%) {.unnumbered}
critical_val <- qt(0.975, df = 9)

ggplot(df_t, aes(x = x, y = y)) +
  geom_line() +
  geom_area(data = filter(df_t, x > critical_val), fill = "red", alpha = 0.5) +
  geom_area(data = filter(df_t, x < -critical_val), fill = "red", alpha = 0.5) +
  geom_vline(xintercept = c(critical_val, -critical_val), linetype = "dashed") +
  labs(title = "t分布と棄却域 (両側5%)", x = "t値", y = "確率密度")
```

## 1標本のt検定

あるデータの平均値が、特定の値 $\mu_0$ と異なるかどうかを検定します。

例：あるクラスのテストの平均点が、全国平均の50点と異なるか？

```{r}
# サンプルデータ作成 {.unnumbered}
scores <- c(55, 60, 45, 70, 58, 62, 48, 52, 65, 50)

# t検定 (mu = 50 と比較) {.unnumbered}
t.test(scores, mu = 50)
```

結果の見方:

1.  **p値 (p-value)**: `0.02939` となりました。
    -   これは、「もし本当にクラスの平均点が50点だとしたら、今回のような（あるいはもっと極端な）データが得られる確率は約2.9%しかない」という意味です。
    -   この確率は、一般的な基準である有意水準 5% (0.05) よりも小さいです。
2.  **結論**: 帰無仮説（平均点は50点である）を棄却します。
    -   つまり、「偶然で片付けるには確率が低すぎる」と判断し、「このクラスの平均点は50点とは統計的に有意に異なる」と結論づけます。
    -   95%信頼区間 (`50.8` 〜 `62.2`) を見ても、50点が含まれていないことがわかります。

## 課題

1.  `tips` データの `total_bill` の平均値が 20ドル と異なるかどうかを検定してください。
    帰無仮説、対立仮説、p値、そして結論（棄却するかどうか）を答えてください。

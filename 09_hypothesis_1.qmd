# 第9回 仮説検定 (1) {.unnumbered}

![仮説検定 (1)](figure/09_hypothesis_1/infographic.png)

## 裁判官になるための統計学

「この新薬は効く！」
「私の予知能力は本物だ！」

世の中には、様々な主張が溢れている。しかし、科学の世界では「言った者勝ち」は通用しない。
その主張が、たまたまの偶然なのか、それとも確かな証拠に基づいているのか。
それを厳格にジャッジする手続きが**仮説検定 (Hypothesis Testing)** 。

仮説検定の仕組みは、**刑事裁判**にそっくりです。
今回は、あなたが裁判官となって、「偶然かどうか」という難事件に判決を下す方法を学ぼう。

## 1. 裁判の基本ルール：疑わしきは罰せず

統計的検定の世界では、まず最初に「何の効果もない（無罪）」と仮定することから始めます。これを覆すだけの強力な証拠が出て初めて、「効果がある（有罪）」と認めることになる。

### 登場人物（仮説）

1.  **被告人：帰無仮説 ($H_0$)**
    *   「差はない」「効果はない」という、否定したい仮説。
    *   裁判で言えば**「被告人は無罪である」**という前提。
2.  **検察官：対立仮説 ($H_1$)**
    *   「差がある」「効果がある」という、証明したい仮説。
    *   裁判で言えば**「被告人は有罪である」**という主張。

検定のゴールは、**「無罪（$H_0$）と仮定するには、証拠（データ）が不自然すぎる」**ことを示し、無罪の前提を棄却すること。

## 2. 証拠の評価：p値という驚き

裁判官であるあなたは、提出された証拠（データ）を見て判断する。
ここで重要なのが **p値 (p-value)** 。

p値とは、**「もし被告人が無罪だとしたら、こんな証拠が出てくる確率はどれくらいか？」**という値。

*   **p値が大きい（0.5とか）**: 「無罪の人からも、よく出る証拠だ」。
    *   判決：無罪を棄却できない（証拠不十分）。
*   **p値が極めて小さい（0.001とか）**: 「無罪だとしたら、こんな証拠が出るのはありえない（奇跡に近い）」。
    *   判決：無罪ではないだろう。**有罪（有意）**！

### 判決の基準：有意水準 ($\alpha$)

どこまで確率が低ければ「ありえない」と判断するのか？
その基準を**有意水準**と呼び、通常 **5% (0.05)** に設定します。

*   「無罪なのにこんな証拠が出る確率は5%未満」なら、それはもう偶然とは考えない。
*   この基準を超えたとき、**「統計的に有意である (Statistically Significant)」** と宣言します。

## 3. シミュレーション：無罪の証明

t分布を使って、「無罪（偶然）」の範囲を可視化してみましょう。

```{r}
library(tidyverse)
# theme_set(theme_gray(base_family = "HiraKakuProN-W3")) # [対象注意] Mac用設定

# t分布 (自由度9)
x <- seq(-4, 4, length.out = 100)
y <- dt(x, df = 9)
df_t <- data.frame(x, y)

# 判決のライン（有意水準5%の両側）
critical_val <- qt(0.975, df = 9)

ggplot(df_t, aes(x = x, y = y)) +
  theme_gray(base_family = "HiraKakuProN-W3") + # [対象注意] Mac用設定
  geom_line() +
  geom_area(data = filter(df_t, x > critical_val), fill = "red", alpha = 0.5) +
  geom_area(data = filter(df_t, x < -critical_val), fill = "red", alpha = 0.5) +
  geom_vline(xintercept = c(critical_val, -critical_val), linetype = "dashed") +
  labs(title = "有罪判決のライン (棄却域)", x = "検定統計量 (t値)", y = "確率密度")
```

赤いエリアが「有罪（棄却域）」。データから計算したt値がここに入れば、「無罪」の前提は棄却されます。

## 4. 実践：1標本のt検定

実際の事件（データ）を裁いてみましょう。

**事件**: あるクラス10人のテスト平均点は、全国平均の「50点」と違うのか？
`scores <- c(55, 60, 45, 70, 58, 62, 48, 52, 65, 50)`

1.  **帰無仮説 ($H_0$)**: 平均点に違いはない（$\mu = 50$）。
2.  **対立仮説 ($H_1$)**: 平均点に違いがある（$\mu \neq 50$）。

```{r}
scores <- c(55, 60, 45, 70, 58, 62, 48, 52, 65, 50)
t.test(scores, mu = 50)
```

**判決**:
p値は `0.02939` 。これは 0.05（5%）より小さい。
つまり、「平均50点の集団から、偶然この点数が取れる確率は約2.9%しかない」。
裁判官（あなた）は、「偶然にしては出来すぎている」と判断し、**帰無仮説を棄却**します。

結論：**このクラスの平均点は、全国平均と有意に異なる。**

## 5. 冤罪のリスク：2つの過誤

裁判に誤審があるように、統計的検定にも誤りのリスクがあります。

| | 被告人は無実 ($H_0$ 真) | 被告人はクロ ($H_1$ 真) |
|---|---|---|
| **有罪判決 ($H_0$ 棄却)** | **冤罪 (第1種の過誤)**<br>何も無いのに「ある」と言う<br>確率 $\alpha$ (5%) | 正しい判決 |
| **無罪判決 ($H_0$ 棄却せず)** | 正しい判決 | **取り逃がし (第2種の過誤)**<br>あるのに「ない」と言う<br>確率 $\beta$ |

我々が設定した「有意水準5%」とは、「5%の確率で冤罪（第1種の過誤）を起こすことを許容する」という宣言でもある。
だからこそ、p値が小さいことは「絶対の真実」ではなく、「かなり確からしい」という程度の意味なのだ。

## 課題

1.  **Tipsデータの分析**:
    `tips` データの `total_bill` の平均値が 20ドル と異なるかどうかを検定してください。
    帰無仮説 $H_0$ と対立仮説 $H_1$ を数式で記述し、結果のp値に基づいて結論（棄却するか否か）を述べてください。

## 練習問題

### 練習1: 結論の解釈
ある検定の結果、p値が `0.08` でした。有意水準5%の場合、以下の主張は正しいですか？
「p値 > 0.05 なので、帰無仮説は正しいと証明された。」

### 練習2: サンプルサイズと有意差
前回使用したシミュレーションコードを使い、$H_0: \mu=50$ が誤り（真の $\mu=52$）であるデータを生成してください。サンプルサイズ $n$ を変えたとき、p値がどう変化するか確認してください。

### 練習3: 誤りの種類
「ガンではない患者を、誤ってガンであると診断してしまう」のは、第1種の過誤ですか、第2種の過誤ですか？（帰無仮説：「ガンではない」とした場合）

## まとめ

| 裁判用語 | 統計用語 | 意味 |
|---|---|---|
| **被告人は無罪** | **帰無仮説 ($H_0$)** | 「差はない」という前提 |
| **被告人は有罪** | **対立仮説 ($H_1$)** | 「差がある」という主張 |
| **証拠の不自然さ** | **p値** | 無罪前提でそのデータが出る確率 |
| **判決の基準** | **有意水準 ($\alpha$)** | p値がこれ未満なら有罪（棄却） |
| **冤罪** | **第1種の過誤** | 無罪なのに有罪にしてしまうミス |

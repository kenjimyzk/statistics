{
  "hash": "0663cc1fb29b543757c611aa43ab0105",
  "result": {
    "engine": "knitr",
    "markdown": "# 第6回 主要な確率分布 {.unnumbered}\n\n![主要な確率分布](figure/06_distributions/infographic.png)\n\n## 世界を支配する「釣り鐘」\n\n身長、テストの点数、工場の部品サイズ、株価の変動...。\nまったく異なるこれらすべての現象に、どこにでも現れる不思議な曲線があります。\n**正規分布（Normal Distribution）**。またの名を、**ガウス分布**。\n\nなぜ世界は、ことあるごとに正規分布したがるのか？\nその秘密は、統計学で最強の定理（中心極限定理）にあります。まずはこの「王様」の振る舞いを知ることから始めましょう。\n\n本節では、統計解析の主役である正規分布と、その親戚たち（二項分布、t分布など）を、Rを使って自在に操れるようになります。\n\n## 1. 統計学の王様：正規分布\n\n正規分布は、平均 $\\mu$ と分散 $\\sigma^2$ 。たった2つのパラメータで完全に決まる、左右対称の美しい釣鐘型をしています。\n\n$$f(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(x-\\mu)^2}{2\\sigma^2}\\right)$$\n\n数式は複雑に見えますが、Rなら一瞬で描けます。\n\n### 4つの魔法の呪文\n\nRには確率分布を扱うための共通の「呪文（接頭辞）」があります。これさえ覚えれば、勝てます。\n\n-   **`d` (Density)**: 確率密度。グラフの高さ。 (`dnorm`)\n-   **`p` (Probability)**: 累積確率。ある地点より左側の面積。 (`pnorm`)\n-   **`q` (Quantile)**: 分位点。確率から値を逆算する。 (`qnorm`)\n-   **`r` (Random)**: 乱数生成。シミュレーション用。 (`rnorm`)\n\n### 正規分布を描いてみる\n\nまずは標準正規分布（平均0、分散1）を見てみましょう。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\n# x軸の範囲定義\nx <- seq(-4, 4, length.out = 100)\n# 確率密度の計算 (dnorm)\ny <- dnorm(x, mean = 0, sd = 1)\n\ndf <- data.frame(x, y)\n\nggplot(df, aes(x = x, y = y)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") + # [対象注意] Mac用設定\n  geom_line() +\n  labs(title = \"標準正規分布 (Mean=0, SD=1)\")\n```\n\n::: {.cell-output-display}\n![](06_distributions_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n### パラメータを変えてみる\n\n平均がズレると山が移動し、標準偏差が大きくなると山が平らになります。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- seq(-10, 15, length.out = 200)\ndf_compare <- data.frame(\n  x = rep(x, 3),\n  y = c(dnorm(x, mean = 0, sd = 1),\n        dnorm(x, mean = 5, sd = 1),\n        dnorm(x, mean = 0, sd = 2)),\n  type = rep(c(\"μ=0, σ=1\", \"μ=5, σ=1\", \"μ=0, σ=2\"), each = length(x))\n)\n\nggplot(df_compare, aes(x = x, y = y, color = type)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") + # [対象注意] Mac用設定\n  geom_line(size = 1) +\n  labs(title = \"パラメータによる正規分布の変化\", color = \"設定\")\n```\n\n::: {.cell-output-display}\n![](06_distributions_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## 現実の問いに答える：確率計算\n\n「平均50、標準偏差10のテストで、60点以上をとる確率は？」\nこの問いに答えるのが **`p` (累積確率)** の関数です。\n\n`pnorm(60)` は「$-\\infty$ から 60 までの面積」を返します。\n「60点**以上**」を知りたいなら、全体（100% = 1）から「60点**以下**」の確率を引けばいい。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# P(X >= 60) = 1 - P(X <= 60)\n1 - pnorm(60, mean = 50, sd = 10)\n#> [1] 0.1586553\n```\n:::\n\n\n約15.9%。クラスの16%は、偏差値60以上ということ。\n\n### 68-95-99.7 ルール\n\n正規分布には、覚えておくべき相場観があります。\n「データの大半は、平均から標準偏差の3倍以内に収まる」というルールです。\n\n-   $\\pm 1\\sigma$: 約68% （偏差値40〜60）\n-   $\\pm 2\\sigma$: 約95% （偏差値30〜70）\n-   $\\pm 3\\sigma$: 約99.7% （ほぼすべて）\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- seq(-4, 4, length.out = 100)\ny <- dnorm(x)\ndf <- data.frame(x, y)\n\nggplot(df, aes(x = x, y = y)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") + # [対象注意] Mac用設定\n  geom_line() +\n  geom_area(data = filter(df, x >= -1 & x <= 1), fill = \"blue\", alpha = 0.3) +\n  geom_area(data = filter(df, x >= -2 & x <= 2), fill = \"green\", alpha = 0.2) +\n  geom_area(data = filter(df, x >= -3 & x <= 3), fill = \"red\", alpha = 0.1) +\n  labs(title = \"正規分布の区間確率 (1SD, 2SD, 3SD)\", x = \"標準偏差 (z)\", y = \"確率密度\")\n```\n\n::: {.cell-output-display}\n![](06_distributions_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## 2. コイン投げの積み重ね：二項分布\n\n次に、離散型の代表、**二項分布**。\n「成功か失敗か」のギャンブル（ベルヌーイ試行）を $n$ 回繰り返したとき、何回勝てるか？を表す分布です。\n\n### 二項分布の3条件\n\n単なる繰り返しではなく、3つの条件が必要です。\n1.  回数 $n$ が決まっている。\n2.  毎回のリセット（独立性）。前の結果に引きずられない。\n3.  勝率 $p$ が変わらない。\n\n### シミュレーション：運命の分かれ道\n\nコイン投げ（$p=0.5$）を10回行う勝負を考えます。\n「ちょうど5回勝つ確率」はどれくらいか。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# dbinom で確率（点）を計算\ndbinom(5, size = 10, prob = 0.5)\n#> [1] 0.2460938\n```\n:::\n\n\n約24.6%。意外と低いですか？\nすべてのパターンの確率を並べてみます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- 0:10\nprob <- dbinom(x, size = 10, prob = 0.5)\ndf_binom <- data.frame(x = factor(x), prob = prob)\n\nggplot(df_binom, aes(x = x, y = prob)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") + # [対象注意] Mac用設定\n  geom_col(fill = \"lightgreen\") +\n  labs(title = \"二項分布 (n=10, p=0.5)\", x = \"成功回数\", y = \"確率\")\n```\n\n::: {.cell-output-display}\n![](06_distributions_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### 回数を増やすと、奇跡が起きる\n\nここからが統計学のハイライト。\nこのカクカクした二項分布、試行回数 $n$ をどんどん増やしていくと、どうなるか。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 試行回数 n を変化させた場合の分布形状\nn_values <- c(30, 10, 100) # ユーザーによる順序指定あり\np <- 0.3\n\ndf_binom_approx <- data.frame()\nfor(n in n_values) {\n  x <- 0:n\n  prob <- dbinom(x, size = n, prob = p)\n  df_binom_approx <- rbind(df_binom_approx, data.frame(x=x, prob=prob, n=paste0(\"n=\", n)))\n}\n\nggplot(df_binom_approx, aes(x = x, y = prob)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") + # [対象注意] Mac用設定\n  geom_col(fill = \"steelblue\") +\n  # nの順序を整えて表示（小さいnから順に見るため）\n  facet_wrap(~ fct_relevel(n, \"n=10\", \"n=30\", \"n=100\"), scales = \"free_x\") +\n  labs(title = \"nの増加に伴う二項分布の正規近似\", x = \"成功回数\")\n```\n\n::: {.cell-output-display}\n![](06_distributions_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n$n$ が増えるにつれて、分布の左右対称性が増し、きれいな釣鐘型に近づいているのがわかります。\n「離散的なコイン投げ」が、積み重なることで「連続的な正規分布」に化けました。\n\nこれを**正規近似**（ド・モアブル＝ラプラスの定理）と呼び、後の**中心極限定理**へとつながる重要な性質です。\n\n## 3. 正規分布の子供たち（派生分布）\n\n最後に、推測統計の現場で頻繁に使われる3つの分布を紹介します。\nこれらはすべて、正規分布を親として生まれた「正規分布ファミリー」。\n今は定義を丸暗記する必要はありません。「何のために生まれたか」という役割だけ、押さえておきます。\n\n### カイ二乗分布 ($\\chi^2$)：ブレの分析官\n\n-   **出自**: 標準正規分布の2乗和。\n-   **役割**: 「分散（ばらつき）」を分析すること。\n-   **特徴**: 2乗しているのでマイナスにはなりません。適合度検定などで活躍します。\n\n### t分布 ($t$)：現場の代役\n\n-   **出自**: 正規分布 ÷ $\\sqrt{\\chi^2/k}$。\n-   **役割**: データ数（標本）が少ないときに、正規分布の代役を務める。\n-   **特徴**: 正規分布より裾が厚く、外れ値のリスクを織り込んでいます。「母分散がわからない」という現実的な状況で、平均値を検定するための分布です。\n\n### F分布 ($F$)：比較のスペシャリスト\n\n-   **出自**: 2つのカイ二乗分布の比。\n-   **役割**: 2つの「分散」を比べること。\n-   **特徴**: 分散分析（ANOVA）で、グループ間の差が誤差より大きいかを判定する際に使われます。\n\n## 課題\n\n自らの手で確率を計算し、モデルの感覚を掴んでください。\n\n1.  **正規分布の計算**:\n    日本人成人男性の身長が平均171cm、標準偏差6cmの正規分布に従うと仮定します。\n    身長が180cm以上の人は、上位何パーセントに含まれますか？\n2.  **二項分布の計算**:\n    サイコロを10回振ったとき、1の目が「ちょうど2回」出る確率は？（ヒント：$n=10, p=1/6$）\n\n## 練習問題\n\n### 練習1: テストの点数分布\n平均50点、標準偏差10点の正規分布に従うテストについて：\n\n1. 40点以下となる確率は？\n2. 40点から60点の間に入る確率は？\n3. 上位10%に入るには何点以上必要ですか？ (`qnorm`を使って逆算してください)\n\n### 練習2: 不良品の発生確率\n不良品率が10% ($p=0.1$) の製造ラインで製品を20個 ($n=20$) 作る場合：\n1. 不良品が1個も出ない確率\n2. 不良品が3個以上出る確率（`sum(dbinom(3:20, ...))`）\n\n### 練習3: 乱数シミュレーション\n標準正規分布から乱数を100個生成しヒストグラムを描画してください。\nその後、サンプルサイズを1,000個、10,000個と増やしたとき、ヒストグラムの形状がどのように理論分布（釣鐘型）に近づくか確認してください。\n",
    "supporting": [
      "06_distributions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
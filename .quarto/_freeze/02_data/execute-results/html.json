{
  "hash": "a928ca4eaf4253fc602cffc40ef29eba",
  "result": {
    "engine": "knitr",
    "markdown": "# 第2回 データの構造と扱い {.unnumbered}\n\n![データの構造](figure/02_data/infographic.png)\n\n## 今回の目標\n\n-   Rでのデータの持ち方（データフレーム）を理解する。\n-   外部データ（CSVファイルなど）を読み込む方法を学ぶ。\n-   **Tidyverse** パッケージを使った基本的なデータ操作を学ぶ。\n\n## パッケージの準備\n\nRには便利な機能を追加する **パッケージ** という仕組みがあります。\nこの講義では、データ分析に必須のパッケージ群 **Tidyverse** を使います。\n\n### Tidyverseとは\n\nTidyverseは、データサイエンスのために設計されたパッケージの集合体です。主に以下のパッケージが含まれています：\n\n| パッケージ | 主な用途 |\n|-----------|---------|\n| `ggplot2` | データの可視化（グラフ作成） |\n| `dplyr` | データの操作・加工 |\n| `tidyr` | データの整形 |\n| `readr` | データの読み込み |\n| `stringr` | 文字列の操作 |\n| `forcats` | カテゴリ変数（因子）の操作 |\n\n初回のみインストールが必要です（前回の課題で実施済みなら不要）。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"tidyverse\") {.unnumbered}\n```\n:::\n\n\n使うときは毎回 `library()` 関数で読み込みます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n## データフレーム\n\n統計分析では、Excelのような表形式のデータを扱います。Rではこれを **データフレーム** と呼びます。\nRには練習用のデータセットがいくつか入っています。`iris`（アヤメのデータ）を見てみましょう。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(iris) # 最初の6行を表示\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Sepal.Length\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Sepal.Width\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Petal.Length\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Petal.Width\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Species\"],\"name\":[5],\"type\":[\"fct\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"5.1\",\"2\":\"3.5\",\"3\":\"1.4\",\"4\":\"0.2\",\"5\":\"setosa\",\"_rn_\":\"1\"},{\"1\":\"4.9\",\"2\":\"3.0\",\"3\":\"1.4\",\"4\":\"0.2\",\"5\":\"setosa\",\"_rn_\":\"2\"},{\"1\":\"4.7\",\"2\":\"3.2\",\"3\":\"1.3\",\"4\":\"0.2\",\"5\":\"setosa\",\"_rn_\":\"3\"},{\"1\":\"4.6\",\"2\":\"3.1\",\"3\":\"1.5\",\"4\":\"0.2\",\"5\":\"setosa\",\"_rn_\":\"4\"},{\"1\":\"5.0\",\"2\":\"3.6\",\"3\":\"1.4\",\"4\":\"0.2\",\"5\":\"setosa\",\"_rn_\":\"5\"},{\"1\":\"5.4\",\"2\":\"3.9\",\"3\":\"1.7\",\"4\":\"0.4\",\"5\":\"setosa\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### データフレームの構造を確認する\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# データの次元（行数 × 列数）\ndim(iris)\n#> [1] 150   5\n\n# 列名の確認\nnames(iris)\n#> [1] \"Sepal.Length\" \"Sepal.Width\"  \"Petal.Length\" \"Petal.Width\"  \"Species\"\n\n# データの構造を確認\nstr(iris)\n#> 'data.frame':\t150 obs. of  5 variables:\n#>  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...\n#>  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...\n#>  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...\n#>  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...\n#>  $ Species     : Factor w/ 3 levels \"setosa\",\"versicolor\",..: 1 1 1 1 1 1 1 1 1 1 ...\n```\n:::\n\n\n### データ型について\n\nRには主に以下のデータ型があります：\n\n| データ型 | 説明 | 例 |\n|---------|------|-----|\n| numeric | 数値 | 1.5, 100, -3.14 |\n| integer | 整数 | 1L, 2L, 100L |\n| character | 文字列 | \"東京\", \"hello\" |\n| logical | 論理値 | TRUE, FALSE |\n| factor | カテゴリ | 男性/女性, 大/中/小 |\n\n## データの読み込み\n\n自分のデータを分析するには、CSVファイルなどを読み込む必要があります。\n`read_csv()` 関数を使います。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data.csv というファイルがある場合の例 {.unnumbered}\n# df <- read_csv(\"data.csv\") {.unnumbered}\n```\n:::\n\n\n### よく使うデータ読み込み関数\n\n| 関数 | ファイル形式 | パッケージ |\n|------|-------------|-----------|\n| `read_csv()` | CSV（カンマ区切り） | readr (tidyverse) |\n| `read_tsv()` | TSV（タブ区切り） | readr (tidyverse) |\n| `read_excel()` | Excel (.xlsx) | readxl |\n| `read.csv()` | CSV | base R |\n\n今回は、Web上のCSVデータを読み込んでみましょう。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://raw.githubusercontent.com/mwaskom/seaborn-data/master/tips.csv\"\ntips <- read_csv(url)\n```\n:::\n\n\nデータの概要を確認します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(tips)\n#> Rows: 244\n#> Columns: 7\n#> $ total_bill <dbl> 16.99, 10.34, 21.01, 23.68, 24.59, 25.29, 8.77, 26.88, 15.0…\n#> $ tip        <dbl> 1.01, 1.66, 3.50, 3.31, 3.61, 4.71, 2.00, 3.12, 1.96, 3.23,…\n#> $ sex        <chr> \"Female\", \"Male\", \"Male\", \"Male\", \"Female\", \"Male\", \"Male\",…\n#> $ smoker     <chr> \"No\", \"No\", \"No\", \"No\", \"No\", \"No\", \"No\", \"No\", \"No\", \"No\",…\n#> $ day        <chr> \"Sun\", \"Sun\", \"Sun\", \"Sun\", \"Sun\", \"Sun\", \"Sun\", \"Sun\", \"Su…\n#> $ time       <chr> \"Dinner\", \"Dinner\", \"Dinner\", \"Dinner\", \"Dinner\", \"Dinner\",…\n#> $ size       <dbl> 2, 3, 3, 2, 4, 4, 2, 4, 2, 2, 2, 4, 2, 4, 2, 2, 3, 3, 3, 3,…\n```\n:::\n\n\n### tipsデータの説明\n\nこのデータはレストランでのチップに関するデータです。\n\n| 変数名 | 説明 |\n|--------|------|\n| total_bill | 支払総額（ドル） |\n| tip | チップの額（ドル） |\n| sex | 支払者の性別 |\n| smoker | 喫煙者かどうか |\n| day | 曜日 |\n| time | 時間帯（ランチ/ディナー） |\n| size | グループの人数 |\n\n## データの操作 (dplyr)\n\nTidyverseに含まれる `dplyr` パッケージを使うと、データの加工が直感的に行えます。\n\n### 1. 列を選ぶ: `select()`\n\n特定の列だけを取り出します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntips %>% \n  select(total_bill, tip) %>% \n  head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"total_bill\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"16.99\",\"2\":\"1.01\"},{\"1\":\"10.34\",\"2\":\"1.66\"},{\"1\":\"21.01\",\"2\":\"3.50\"},{\"1\":\"23.68\",\"2\":\"3.31\"},{\"1\":\"24.59\",\"2\":\"3.61\"},{\"1\":\"25.29\",\"2\":\"4.71\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n`%>%` は **パイプ演算子** といい、「左の結果を右の関数に渡す」という意味です。\n「tipsデータ **を** selectする」と読みます。\n\n### 2. 行を選ぶ: `filter()`\n\n条件に合う行だけを取り出します。\n例えば、`time` が \"Dinner\" のデータだけ抽出します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntips %>% \n  filter(time == \"Dinner\") %>% \n  head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"total_bill\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sex\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"smoker\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"day\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"time\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"size\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"16.99\",\"2\":\"1.01\",\"3\":\"Female\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"2\"},{\"1\":\"10.34\",\"2\":\"1.66\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"3\"},{\"1\":\"21.01\",\"2\":\"3.50\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"3\"},{\"1\":\"23.68\",\"2\":\"3.31\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"2\"},{\"1\":\"24.59\",\"2\":\"3.61\",\"3\":\"Female\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"4\"},{\"1\":\"25.29\",\"2\":\"4.71\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"4\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### 3. 新しい列を作る: `mutate()`\n\n計算結果などを新しい列として追加します。\nチップの割合（チップ / 総額）を計算してみましょう。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntips %>% \n  mutate(tip_rate = tip / total_bill) %>% \n  select(total_bill, tip, tip_rate) %>% \n  head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"total_bill\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip_rate\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"16.99\",\"2\":\"1.01\",\"3\":\"0.05944673\"},{\"1\":\"10.34\",\"2\":\"1.66\",\"3\":\"0.16054159\"},{\"1\":\"21.01\",\"2\":\"3.50\",\"3\":\"0.16658734\"},{\"1\":\"23.68\",\"2\":\"3.31\",\"3\":\"0.13978041\"},{\"1\":\"24.59\",\"2\":\"3.61\",\"3\":\"0.14680765\"},{\"1\":\"25.29\",\"2\":\"4.71\",\"3\":\"0.18623962\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### 5. データの並び替え: `arrange()`\n\nデータを特定の列の値で並び替えます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 支払総額の小さい順に並べる\ntips %>% \n  arrange(total_bill) %>% \n  head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"total_bill\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sex\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"smoker\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"day\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"time\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"size\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"3.07\",\"2\":\"1.00\",\"3\":\"Female\",\"4\":\"Yes\",\"5\":\"Sat\",\"6\":\"Dinner\",\"7\":\"1\"},{\"1\":\"5.75\",\"2\":\"1.00\",\"3\":\"Female\",\"4\":\"Yes\",\"5\":\"Fri\",\"6\":\"Dinner\",\"7\":\"2\"},{\"1\":\"7.25\",\"2\":\"1.00\",\"3\":\"Female\",\"4\":\"No\",\"5\":\"Sat\",\"6\":\"Dinner\",\"7\":\"1\"},{\"1\":\"7.25\",\"2\":\"5.15\",\"3\":\"Male\",\"4\":\"Yes\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"2\"},{\"1\":\"7.51\",\"2\":\"2.00\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Thur\",\"6\":\"Lunch\",\"7\":\"2\"},{\"1\":\"7.56\",\"2\":\"1.44\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Thur\",\"6\":\"Lunch\",\"7\":\"2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n\n# 降順（大きい順）にする場合は desc() を使う\ntips %>% \n  arrange(desc(total_bill)) %>% \n  head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"total_bill\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sex\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"smoker\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"day\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"time\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"size\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"50.81\",\"2\":\"10.00\",\"3\":\"Male\",\"4\":\"Yes\",\"5\":\"Sat\",\"6\":\"Dinner\",\"7\":\"3\"},{\"1\":\"48.33\",\"2\":\"9.00\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sat\",\"6\":\"Dinner\",\"7\":\"4\"},{\"1\":\"48.27\",\"2\":\"6.73\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sat\",\"6\":\"Dinner\",\"7\":\"4\"},{\"1\":\"48.17\",\"2\":\"5.00\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"6\"},{\"1\":\"45.35\",\"2\":\"3.50\",\"3\":\"Male\",\"4\":\"Yes\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"3\"},{\"1\":\"44.30\",\"2\":\"2.50\",\"3\":\"Female\",\"4\":\"Yes\",\"5\":\"Sat\",\"6\":\"Dinner\",\"7\":\"3\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### 6. 要約統計量を計算: `summarize()`\n\nデータの要約統計量（平均、合計など）を計算します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntips %>% \n  summarize(\n    平均支払額 = mean(total_bill),\n    平均チップ = mean(tip),\n    データ数 = n()\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"平均支払額\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"平均チップ\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"データ数\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"19.78594\",\"2\":\"2.998279\",\"3\":\"244\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nグループごとに集計する場合は、`group_by()` と組み合わせます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 曜日ごとの平均支払額を計算\ntips %>% \n  group_by(day) %>% \n  summarize(\n    平均支払額 = mean(total_bill),\n    データ数 = n()\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"day\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"平均支払額\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"データ数\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Fri\",\"2\":\"17.15158\",\"3\":\"19\"},{\"1\":\"Sat\",\"2\":\"20.44138\",\"3\":\"87\"},{\"1\":\"Sun\",\"2\":\"21.41000\",\"3\":\"76\"},{\"1\":\"Thur\",\"2\":\"17.68274\",\"3\":\"62\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## パイプ演算子 `%>%` の活用\n\nパイプ演算子を使うと、複数の操作を順番につなげられます。\n「データを読み込んで、フィルタして、新しい列を作って、並び替える」といった一連の操作を、読みやすく書けます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 例: ディナーのデータだけを抽出し、チップ率を計算し、支払額の大きい順に並べる\ntips %>% \n  filter(time == \"Dinner\") %>% \n  mutate(tip_rate = tip / total_bill * 100) %>%  # パーセントで表示\n  arrange(desc(total_bill)) %>% \n  select(total_bill, tip, tip_rate, day) %>% \n  head(10)  # 上位10件のみ表示\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"total_bill\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip_rate\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"day\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"50.81\",\"2\":\"10.00\",\"3\":\"19.681165\",\"4\":\"Sat\"},{\"1\":\"48.33\",\"2\":\"9.00\",\"3\":\"18.621974\",\"4\":\"Sat\"},{\"1\":\"48.27\",\"2\":\"6.73\",\"3\":\"13.942407\",\"4\":\"Sat\"},{\"1\":\"48.17\",\"2\":\"5.00\",\"3\":\"10.379905\",\"4\":\"Sun\"},{\"1\":\"45.35\",\"2\":\"3.50\",\"3\":\"7.717751\",\"4\":\"Sun\"},{\"1\":\"44.30\",\"2\":\"2.50\",\"3\":\"5.643341\",\"4\":\"Sat\"},{\"1\":\"40.55\",\"2\":\"3.00\",\"3\":\"7.398274\",\"4\":\"Sun\"},{\"1\":\"40.17\",\"2\":\"4.73\",\"3\":\"11.774956\",\"4\":\"Fri\"},{\"1\":\"39.42\",\"2\":\"7.58\",\"3\":\"19.228818\",\"4\":\"Sat\"},{\"1\":\"38.73\",\"2\":\"3.00\",\"3\":\"7.745933\",\"4\":\"Sat\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## データ操作のヒント\n\n### ヒント1: 列名の指定方法\n列を指定する方法は2つあります。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 方法1: $ を使う\ntips$total_bill\n\n# 方法2: dplyrで直接列名を書く（パイプと相性が良い）\ntips %>% select(total_bill)\n```\n:::\n\n\n### ヒント2: 複数の条件を組み合わせる\n`filter()` では、`&`（かつ）や `|`（または）を使って複数の条件を組み合わせられます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 支払額が20ドル以上、かつディナーのデータ\ntips %>% \n  filter(total_bill >= 20 & time == \"Dinner\") %>% \n  head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"total_bill\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sex\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"smoker\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"day\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"time\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"size\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"21.01\",\"2\":\"3.50\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"3\"},{\"1\":\"23.68\",\"2\":\"3.31\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"2\"},{\"1\":\"24.59\",\"2\":\"3.61\",\"3\":\"Female\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"4\"},{\"1\":\"25.29\",\"2\":\"4.71\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"4\"},{\"1\":\"26.88\",\"2\":\"3.12\",\"3\":\"Male\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"4\"},{\"1\":\"35.26\",\"2\":\"5.00\",\"3\":\"Female\",\"4\":\"No\",\"5\":\"Sun\",\"6\":\"Dinner\",\"7\":\"4\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### 4. データの可視化（チラ見せ）\n\n`ggplot2` を使うと、データの分布を簡単に可視化できます。\n例えば、男女 (`sex`) の人数を棒グラフにしてみましょう。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tips, aes(x = sex)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](02_data_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## 課題\n\n読み込んだ `tips` データを使って、以下の操作を行ってください。\n\n1.  `day` が \"Sun\"（日曜日）のデータだけを `filter()` で抽出してください。\n2.  抽出したデータから、`total_bill` と `size` の列だけを `select()` で選んで表示してください。\n\n## 練習問題\n\n### 練習1: データの確認\n1. `tips` データの行数と列数を確認してください\n2. `tips` データの最後の6行を表示してください（ヒント: `tail()` 関数）\n\n### 練習2: フィルタリング\n1. チップ (`tip`) が3ドル以上のデータだけを抽出してください\n2. 女性 (`sex == \"Female\"`) かつディナー (`time == \"Dinner\"`) のデータを抽出してください\n\n### 練習3: データ加工の組み合わせ\n以下の操作を1つのパイプでつなげて実行してください：\n1. 土曜日 (`day == \"Sat\"`) のデータを抽出\n2. チップ率 (`tip / total_bill * 100`) を新しい列として追加\n3. チップ率の高い順に並び替え\n4. 上位5件を表示\n\n## dplyr関数のまとめ\n\n| 関数 | 用途 | 例 |\n|------|------|-----|\n| `select()` | 列を選択 | `select(data, col1, col2)` |\n| `filter()` | 行を抽出 | `filter(data, x > 10)` |\n| `mutate()` | 新しい列を作成 | `mutate(data, new = x + y)` |\n| `arrange()` | 並び替え | `arrange(data, x)` |\n| `summarize()` | 要約統計量 | `summarize(data, mean(x))` |\n| `group_by()` | グループ化 | `group_by(data, category)` |\n",
    "supporting": [
      "02_data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "6594709aa398eac7f1fef739a6105d81",
  "result": {
    "engine": "knitr",
    "markdown": "# 第10回 仮説検定 (2) {.unnumbered}\n\n![仮説検定 (2)](figure/10_hypothesis_2/infographic.png)\n\n## A vs B：決着をつけよう\n\n「新薬Aは、プラセボBより効くのか？」\n「新しい教育プログラムを受けた生徒は、受けていない生徒より成績が良いか？」\n「ダイエット前後で、体重は本当に減ったのか？」\n\n私たちの世界は、比較で溢れている。\nしかし、単に平均値を比べるだけでは不十分。偶然のバラつきかもしれないからだ。\n\n今回は、2つのグループの間に「意味のある差」があるかどうかを判定する、統計学の定番技 **2標本のt検定** をマスターしよう。\n\n## 1. 2つの島を比べる：対応のないt検定\n\nまずは、全く別々の2つのグループを比較するケース。\n例えば、「ランチ島」に住む人々と、「ディナー島」に住む人々。\n彼らの支払金額に差はあるのか？\n\nこのように、互いに独立したデータを比較する手法を**対応のないt検定 (Unpaired t-test)** と呼ぶ。\n\n### 地形を選ばない万能車：Welchのt検定\n\n2つの島（グループ）は、地形（データのばらつき＝分散）が同じとは限らない。\n昔の教科書には「まず地形が同じか調べて（F検定）、それから車を選べ」と書いてあった。\n\nしかし、現代の統計学では**Welchのt検定**という「全地形対応車」を最初から使うのが常識。\nこれなら、分散が違っていても安全に走行（検定）できる。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nurl <- \"https://raw.githubusercontent.com/mwaskom/seaborn-data/master/tips.csv\"\ntips <- read_csv(url)\n\n# 箱ひげ図：2つの島の地形確認\nggplot(tips, aes(x = time, y = total_bill, fill = time)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") + # [対象注意] Mac用設定\n  geom_boxplot() +\n  labs(title = \"ランチとディナーの支払総額比較\")\n```\n\n::: {.cell-output-display}\n![](10_hypothesis_2_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# Welchのt検定（デフォルトで適用されます）\nt.test(total_bill ~ time, data = tips)\n#> \n#> \tWelch Two Sample t-test\n#> \n#> data:  total_bill by time\n#> t = 3.123, df = 143.29, p-value = 0.002167\n#> alternative hypothesis: true difference in means between group Dinner and group Lunch is not equal to 0\n#> 95 percent confidence interval:\n#>  1.331877 5.925088\n#> sample estimates:\n#> mean in group Dinner  mean in group Lunch \n#>             20.79716             17.16868\n```\n:::\n\n\n**判定**:\np値は約 `0.002`。これは「差がないとしたら、こんなデータは0.2%の確率でしか起きない」ことを意味する。\n偶然とは考えにくい。つまり、**ランチとディナーには有意な差がある**と結論づける。\n\n## 2. ビフォー・アフター：対応のあるt検定\n\n次は、同じ人が「変身」するケース。\nダイエット前とダイエット後。テスト勉強前と勉強後。\n\nここでは、グループ全体の平均を見るのではなく、**「一人ひとりの変化（差分）」**に注目する。\nこれを**対応のあるt検定 (Paired t-test)** と呼ぶ。\n\n### 変化を捕まえる\n\n同じ人のデータを追跡することで、個人の「もともとの性質」をキャンセルし、純粋な「変化」だけを取り出すことができる。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 5人のダイエット記録\nbefore <- c(70, 80, 75, 60, 65)\nafter  <- c(68, 78, 74, 58, 64)\n\n# paired = TRUE で「対応あり」を指定\nt.test(before, after, paired = TRUE)\n#> \n#> \tPaired t-test\n#> \n#> data:  before and after\n#> t = 6.532, df = 4, p-value = 0.002838\n#> alternative hypothesis: true mean difference is not equal to 0\n#> 95 percent confidence interval:\n#>  0.9199126 2.2800874\n#> sample estimates:\n#> mean difference \n#>             1.6\n```\n:::\n\n\n**事実確認**:\nもしこれを「対応なし（別人のデータ）」として分析してしまうと、p値は `0.75` になり、「差なし」と判定されてしまう。\n対応のある検定を使うことで初めて、微小な変化（-1.6kg）を「有意」として検出できるのだ。\n\n## 3. その差は、どれくらい凄いのか？：効果量\n\np値が小さいことは、「偶然ではない」ことを保証するだけ。\n「すごい差がある」ことの証明ではない。\n\n1万人調査すれば、0.1ミリの身長差でも「有意差あり（p < 0.05）」になる。でも、0.1ミリに意味はあるか？\n\nそこで必要なのが、差の実質的な大きさを表す「スコア」、すなわち**効果量 (Effect Size)** 。\n代表的なスコアである **Cohen's d** を使おう。\n\n### シグナルの強さを測る\n\n$$Cohen's \\ d = \\frac{\\text{平均値の差}}{\\text{標準偏差（ばらつき）}}$$\n\nこれは、「データのばらつき（ノイズ）」に対して、「平均値の差（シグナル）」がどれくらい突き抜けているかを表す。\n\n*   **0.2**: 小さい（ノイズに埋もれがち）\n*   **0.5**: 中くらい（肉眼でもなんとなく分かる）\n*   **0.8**: 大きい（誰が見ても明らか）\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ランチとディナーの差のスコア（Cohen's d）\nd_val <- (mean(tips$total_bill[tips$time==\"Dinner\"]) - mean(tips$total_bill[tips$time==\"Lunch\"])) /\n         sd(tips$total_bill)\n\nd_val\n#> [1] 0.4075842\n```\n:::\n\n\nスコアは約 `0.41`。中程度の効果だ。\n「この差は統計的に有意であり、実質的にも中程度の意味がある」と、胸を張って報告しよう。\n\n## 課題\n\n1.  **喫煙の有無とチップ**:\n    `tips` データを使って、喫煙者 (`Smoker`) と非喫煙者 (`Non-Smoker`) で、チップの額 (`tip`) に差があるかを検定してください（Welchのt検定）。\n    また、その差の効果量 (Cohen's d) を計算し、統計的有意性と実質的意味について論じてください。\n\n## 練習問題\n\n### 練習1: 検定の選択\n以下のシナリオにおいて、最も適切な検定手法（対応ありt検定 / 対応なし(Welch)t検定）を選んでください。\n1.  A組30人とB組30人のテストの平均点の比較。\n2.  高血圧患者30人の、降圧剤投与前と投与後の血圧の比較。\n3.  10組の双子における、兄と弟の身長の比較。\n\n### 練習2: サンプルサイズとp値\n効果量 $d=0.5$ （中程度）の差がある2つの母集団から、\n(a) $n=10$ ずつ\n(b) $n=100$ ずつ\nデータを抽出し、t検定を行った場合のp値をシミュレーションで比較してください。サンプルサイズがp値に与える影響を確認します。\n\n### 練習3: 等分散性の確認はいらない？\n「まずF検定をしてからt検定の種類を選ぶ」という手順が、現在では推奨されない理由を自分の言葉で説明してください。\n\n## まとめ\n\n| 検定手法 | 適用場面 | キャッチコピー |\n|---|---|---|\n| **Welchのt検定** | 独立した2群 | 全地形対応の万能車。デフォルトはこれ。 |\n| **対応のあるt検定** | 同一ペアの比較 | 変化（差分）狙い撃ち。検出力高め。 |\n| **効果量 (Cohen's d)** | 関係性の強さ | p値に頼らない、実力のスコア。 |\n\n## 課題\n\n1.  **喫煙の有無とチップ**:\n    `tips` データを使って、喫煙者 (`Smoker`) と非喫煙者 (`Non-Smoker`) で、チップの額 (`tip`) に差があるかを検定してください（Welchのt検定）。\n    また、その差の効果量 (Cohen's d) を計算し、統計的有意性と実質的意味について論じてください。\n\n## 練習問題\n\n### 練習1: 検定の選択\n以下のシナリオにおいて、最も適切な検定手法（対応ありt検定 / 対応なし(Welch)t検定）を選んでください。\n\n1.  A組30人とB組30人のテストの平均点の比較。\n2.  高血圧患者30人の、降圧剤投与前と投与後の血圧の比較。\n3.  10組の双子における、兄と弟の身長の比較。\n\n### 練習2: サンプルサイズとp値\n効果量 $d=0.5$ （中程度）の差がある2つの母集団から、\n(a) $n=10$ ずつ\n(b) $n=100$ ずつ\nデータを抽出し、t検定を行った場合のp値をシミュレーションで比較してください。サンプルサイズがp値に与える影響を確認します。\n\n### 練習3: 等分散性の確認はいらない？\n「まずF検定をしてからt検定の種類を選ぶ」という手順が、現在では推奨されない理由を自分の言葉で説明してください。\n\n## まとめ\n\n| 検定手法 | 適用場面 | Rコード | 備考 |\n|---|---|---|---|\n| **Welchのt検定** | 独立した2群の比較 | `t.test(y ~ x)` | デフォルト。等分散を仮定しない。 |\n| **対応のあるt検定** | 同一対象・ペアの比較 | `t.test(y1, y2, paired=TRUE)` | 差分の1標本検定と等価。検出力が高い。 |\n| **効果量 (Cohen's d)** | 差の実質的な大きさ | (計算式参照) | サンプルサイズに依存しない指標。 |\n",
    "supporting": [
      "10_hypothesis_2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
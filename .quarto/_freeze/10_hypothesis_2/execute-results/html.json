{
  "hash": "f09c4ac2946e5418a45530667e5181ef",
  "result": {
    "engine": "knitr",
    "markdown": "# 第10回 仮説検定 (2) {.unnumbered}\n\n## 今回の目標\n\n-   2つのグループの平均値に差があるかどうかを検定する。\n-   対応のあるデータと対応のないデータの違いを理解する。\n-   効果量の概念を理解する。\n\n## 2標本のt検定の種類\n\n| 種類 | 状況 | 例 |\n|------|------|-----|\n| 対応なし | 独立した2群を比較 | 男性vs女性、薬vsプラセボ |\n| 対応あり | 同じ対象の前後を比較 | ダイエット前後、学習前後 |\n\n## 2標本のt検定（対応なし）\n\n異なる2つのグループ（例：男性と女性、投薬群とプラセボ群）の平均値を比較します。\n\n`tips` データで、ランチ (`Lunch`) とディナー (`Dinner`) で支払総額 (`total_bill`) に差があるか検定してみましょう。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nurl <- \"https://raw.githubusercontent.com/mwaskom/seaborn-data/master/tips.csv\"\ntips <- read_csv(url)\n\n\n\n# 箱ひげ図で確認 {.unnumbered}\nggplot(tips, aes(x = time, y = total_bill, fill = time)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") +\n  geom_boxplot() +\n  labs(title = \"ランチとディナーの支払総額比較\")\n```\n\n::: {.cell-output-display}\n![](10_hypothesis_2_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# 密度図でも確認 {.unnumbered}\nggplot(tips, aes(x = total_bill, fill = time)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") +\n  geom_density(alpha = 0.5) +\n  labs(title = \"支払総額の分布比較 (密度図)\")\n```\n\n::: {.cell-output-display}\n![](10_hypothesis_2_files/figure-html/unnamed-chunk-1-2.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# t検定 {.unnumbered}\n# total_bill ~ time は「total_bill を time で分ける」という意味 {.unnumbered}\nt.test(total_bill ~ time, data = tips)\n#> \n#> \tWelch Two Sample t-test\n#> \n#> data:  total_bill by time\n#> t = 3.123, df = 143.29, p-value = 0.002167\n#> alternative hypothesis: true difference in means between group Dinner and group Lunch is not equal to 0\n#> 95 percent confidence interval:\n#>  1.331877 5.925088\n#> sample estimates:\n#> mean in group Dinner  mean in group Lunch \n#>             20.79716             17.16868\n```\n:::\n\n\n結果の見方:\n\n1.  **p値 (p-value)**: `0.002167` となりました。\n    -   これは 0.05 よりはるかに小さい値です。したがって、帰無仮説（ランチとディナーで支払総額に差はない）を棄却します。\n    -   結論として、「ランチとディナーの支払総額には統計的に有意な差がある」と言えます。\n2.  **平均値の比較**:\n    -   `mean in group Dinner`: 約 20.8 ドル\n    -   `mean in group Lunch`: 約 17.2 ドル\n    -   ディナーの方が平均して約 3.6 ドル高いことがわかります。95%信頼区間 (`1.33` 〜 `5.93`) も0を含んでおらず、差がプラス（ディナーが高い）であることを示しています。\n\n## 対応のあるt検定 (Paired t-test)\n\n同じ対象に対して2回測定した場合（例：ダイエット前後の体重、テストの事前事後）の比較です。\n`paired = TRUE` オプションを使います。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# サンプルデータ（ダイエット前後の体重） {.unnumbered}\nbefore <- c(70, 80, 75, 60, 65)\nafter  <- c(68, 78, 74, 58, 64)\n\nt.test(before, after, paired = TRUE)\n#> \n#> \tPaired t-test\n#> \n#> data:  before and after\n#> t = 6.532, df = 4, p-value = 0.002838\n#> alternative hypothesis: true mean difference is not equal to 0\n#> 95 percent confidence interval:\n#>  0.9199126 2.2800874\n#> sample estimates:\n#> mean difference \n#>             1.6\n```\n:::\n\n\n結果の見方:\n\n1.  **p値**: `0.002838` となりました。\n    -   0.05 より小さいため、帰無仮説（ダイエット前後で差はない）を棄却します。\n    -   「ダイエット前後で体重には有意な変化があった」と言えます。\n2.  **平均差 (mean difference)**:\n    -   `1.6` となっています。これは `before - after` の平均値です。\n    -   つまり、平均して 1.6kg 体重が減少したことを意味します（プラスの値なので、beforeの方が大きい）。\n\n## 等分散の仮定\n\n2標本t検定には、両群の分散が等しいという仮定があります。Rの `t.test()` はデフォルトでWelchのt検定（等分散を仮定しない）を使用します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Welchのt検定（デフォルト）\nt.test(total_bill ~ time, data = tips)\n#> \n#> \tWelch Two Sample t-test\n#> \n#> data:  total_bill by time\n#> t = 3.123, df = 143.29, p-value = 0.002167\n#> alternative hypothesis: true difference in means between group Dinner and group Lunch is not equal to 0\n#> 95 percent confidence interval:\n#>  1.331877 5.925088\n#> sample estimates:\n#> mean in group Dinner  mean in group Lunch \n#>             20.79716             17.16868\n\n# Studentのt検定（等分散を仮定）\nt.test(total_bill ~ time, data = tips, var.equal = TRUE)\n#> \n#> \tTwo Sample t-test\n#> \n#> data:  total_bill by time\n#> t = 2.8976, df = 242, p-value = 0.004105\n#> alternative hypothesis: true difference in means between group Dinner and group Lunch is not equal to 0\n#> 95 percent confidence interval:\n#>  1.161839 6.095127\n#> sample estimates:\n#> mean in group Dinner  mean in group Lunch \n#>             20.79716             17.16868\n```\n:::\n\n\n等分散かどうかは、F検定やLevene検定で確認できます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# F検定（等分散の検定）\nvar.test(total_bill ~ time, data = tips)\n#> \n#> \tF test to compare two variances\n#> \n#> data:  total_bill by time\n#> F = 1.4046, num df = 175, denom df = 67, p-value = 0.1109\n#> alternative hypothesis: true ratio of variances is not equal to 1\n#> 95 percent confidence interval:\n#>  0.9237626 2.0595995\n#> sample estimates:\n#> ratio of variances \n#>           1.404557\n```\n:::\n\n\n## 効果量 (Effect Size)\n\np値だけでは効果の大きさがわかりません。**効果量**を計算することで、実質的な差の大きさを評価できます。\n\n### Cohen's d\n\n2群の平均値の差を標準偏差で割った指標です。\n\n$$d = \\frac{\\bar{x}_1 - \\bar{x}_2}{s_{pooled}}$$\n\n- $|d| < 0.2$: 小さい効果\n- $0.2 \\le |d| < 0.8$: 中程度の効果\n- $|d| \\ge 0.8$: 大きい効果\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cohen's d の計算\ndinner <- tips$total_bill[tips$time == \"Dinner\"]\nlunch <- tips$total_bill[tips$time == \"Lunch\"]\n\nmean_diff <- mean(dinner) - mean(lunch)\npooled_sd <- sqrt(((length(dinner)-1)*var(dinner) + (length(lunch)-1)*var(lunch)) / \n                   (length(dinner) + length(lunch) - 2))\n\ncohens_d <- mean_diff / pooled_sd\ncat(\"Cohen's d:\", cohens_d, \"\\n\")\n#> Cohen's d: 0.4137406\n```\n:::\n\n\n## 課題\n\n1.  `tips` データを使って、喫煙者 (`Smoker`) と非喫煙者 (`Non-Smoker`) で、チップの額 (`tip`) に差があるかどうかを検定してください。\n    （注：データ内の値は \"Yes\" / \"No\" です）\n\n## 練習問題\n\n### 練習1: 2標本t検定\n`tips` データを使って以下の検定を行ってください：\n1. 男性と女性で支払総額 (`total_bill`) に差があるか\n2. 土曜日と日曜日でチップ (`tip`) に差があるか\n\n### 練習2: 対応のあるt検定\n以下は10人の学生のテスト前後の点数です：\n\n\n::: {.cell}\n\n```{.r .cell-code}\npre_test <- c(65, 70, 75, 60, 80, 55, 70, 65, 75, 70)\npost_test <- c(70, 75, 80, 65, 85, 60, 78, 70, 80, 75)\n```\n:::\n\n\n1. 対応のあるt検定で、テストの点数が向上したか検定してください\n2. 効果量（Cohen's d）を計算してください\n\n### 練習3: 検定の選択\n以下の状況では、どの検定を使うべきですか？\n1. 新薬を投与した群とプラセボ群の血圧を比較\n2. 同じ患者の治療前と治療後の血圧を比較\n3. 3つの異なる運動プログラムの効果を比較\n\n## 検定のまとめ\n\n| 検定 | 用途 | R関数 |\n|------|------|-------|\n| 1標本t検定 | 1群の平均と特定の値の比較 | `t.test(x, mu = value)` |\n| 2標本t検定（対応なし） | 独立した2群の平均の比較 | `t.test(y ~ group, data)` |\n| 2標本t検定（対応あり） | 対応のある2群の平均の比較 | `t.test(x, y, paired = TRUE)` |\n| F検定 | 2群の分散の比較 | `var.test(y ~ group, data)` |\n",
    "supporting": [
      "10_hypothesis_2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
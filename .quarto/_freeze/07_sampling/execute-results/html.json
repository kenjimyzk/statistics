{
  "hash": "9cb6d230bd10a25580bf0bc4bedb9f4b",
  "result": {
    "engine": "knitr",
    "markdown": "# 第7回 標本分布 {.unnumbered}\n\n![標本分布](figure/07_sampling/infographic.png)\n\n## 一滴の血液で、全身を知る\n\nたった数mlの血液を検査するだけで、全身の健康状態がわかってしまう。\n選挙の出口調査では、数千人の回答から全国民の意思を予測できる。\n\nなぜ、そんなことができるのか？\nなぜ、「一部」を見るだけで「全体」が見えるのか？\n\n今回は、統計的推測の根幹を支える**標本分布**という考え方と、そこに働く数学的な魔法（大数の法則・中心極限定理）について学びます。これで、記述統計から推測統計への架け橋がかかる。\n\n## 1. 未知の世界と鍵穴：母集団と標本\n\n私たちが本当に知りたいのは「全体」のこと。しかし、手に入るのは常に「一部」のデータだけ。\n\n-   **母集団 (Population)**: 知りたい対象の全体。「未知の世界」。無限の広がりを持つ確率分布としてモデル化されます。\n-   **標本 (Sample)**: そこから切り取られた一部のデータ。「鍵穴から覗いた景色」。推測の、唯一の手がかり。\n\n### 全数調査の限界\n\n母集団をすべて調べる「全数調査」は、コスト的にも時間的にもほぼ不可能。\nすべての製品を破壊検査するわけにはいかないし、全ての消費者にアンケートを取ることもできない。\nだからこそ、標本から母集団を推測する技術（推測統計学）が必要になるのです。\n\n### ランダムという名の公平性\n\n標本が母集団を正しく映し出すためには、**ランダム標本**でなければならない。\n恣意的に選ばれたデータではなく、確率 $F(\\mu, \\sigma^2)$ に従って選ばれた独立なデータたち。これを数学的には i.i.d. (独立同一分布) と呼びます。\n\n## 2. パラレルワールドの実験：標本分布\n\nここから少し、想像力を働かせてほしい。\nもし、同じ母集団から、何度も何度も標本抽出をやり直したとしたら、どうなるか？\n\n今回の調査では平均値が $50$ だった。でも別の調査（パラレルワールド）では $52$ かもしれないし、$48$ かもしれない。\nこの「統計量（平均値など）のばらつき」を表した確率分布を、**標本分布 (Sampling Distribution)** と呼びます。\n\n現実には調査は1回しかできません。しかし、この「もし何度もやったらどうなるか」という仮想的な分布こそが、推測の精度の鍵を握っています。\n\nRでパラレルワールドをシミュレーションしてみましょう。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nset.seed(1)\n\n# 母集団分布（平均50, 標準偏差10の正規分布）\npopulation <- rnorm(100000, mean = 50, sd = 10)\n\n# パラレルワールド1：1回目の抽出（n=100）\nsample1 <- sample(population, 100)\nmean(sample1)\n#> [1] 50.24966\n\n# パラレルワールド2：もう1回抽出\nsample2 <- sample(population, 100)\nmean(sample2)\n#> [1] 50.48065\n```\n:::\n\n\n毎回結果が少しずつ違う。この「ブレ」を数学的に捉えるのが目標です。\n\n## 3. 数学的な魔法\n\nサンプルサイズ（標本の大きさ）が増えると、2つの重要な現象が起きる。\n\n### 大数の法則：真実への収束\n\nサンプルサイズ $n$ を大きくしていくと、標本平均は母平均（真の値）に限りなく近づいていく。\n「数は力なり」。データが多ければ多いほど、誤差は消えていく。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 1000\ndice_rolls <- sample(1:6, n, replace = TRUE)\ncumulative_mean <- cumsum(dice_rolls) / (1:n)\n\ndf <- data.frame(n = 1:n, mean = cumulative_mean)\n\nggplot(df, aes(x = n, y = mean)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") + # [対象注意] Mac用設定\n  geom_line() +\n  geom_hline(yintercept = 3.5, color = \"red\", linetype = \"dashed\") +\n  labs(title = \"大数の法則: 試行回数と標本平均の収束\", y = \"標本平均\")\n```\n\n::: {.cell-output-display}\n![](07_sampling_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### 中心極限定理 (CLT)：混沌からの秩序\n\nここが統計学のハイライト。\n**母集団がどんなに歪な分布であっても**、サンプルサイズ $n$ が大きければ、その**標本平均の分布は正規分布に近づいていく**。\n\n元のデータが正規分布していなくても、平均値の分布は正規分布になる。\nこの定理のおかげで、私たちはあらゆるデータに対して正規分布を前提とした推測を行うことができる。\n\n**実験：一様分布から正規分布へ**\n母集団として平坦な一様分布を用意し、そこから標本平均を計算する実験を行います。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. 一様分布のヒストグラム（母集団の形状）\nhist(runif(10000), main = \"Population (Uniform Distribution)\", xlab = \"x\")\n```\n\n::: {.cell-output-display}\n![](07_sampling_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# 2. 標本平均の分布（CLTの確認）\nn_samples <- 1000\nn <- 30 # サンプルサイズ\nmeans <- numeric(n_samples)\n\nfor (i in 1:n_samples) {\n  means[i] <- mean(runif(n))\n}\n\nggplot(data.frame(x = means), aes(x = x)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") + # [対象注意] Mac用設定\n  geom_histogram(bins = 30, fill = \"orange\", color = \"white\") +\n  labs(title = \"標本平均の分布 (n=30)\", x = \"標本平均\")\n```\n\n::: {.cell-output-display}\n![](07_sampling_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n\n見事に釣鐘型（正規分布）が現れました。これが中心極限定理の威力。\n\n### サンプルサイズと分布の鋭さ\n\nデータが増えると、分布はどう変化するのか。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample_sizes <- c(5, 30, 100)\nn_samples <- 2000\n\nresults <- data.frame()\nfor (n in sample_sizes) {\n  # n個の平均をn_samples回計算\n  means <- replicate(n_samples, mean(runif(n)))\n  results <- bind_rows(results, data.frame(means = means, size = paste0(\"n=\", n)))\n}\n\n# nの順序指定\nresults$size <- factor(results$size, levels = paste0(\"n=\", sample_sizes))\n\nggplot(results, aes(x = means)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") + # [対象注意] Mac用設定\n  geom_histogram(bins = 30, fill = \"steelblue\", color = \"white\") +\n  facet_wrap(~size, scales = \"free_y\") +\n  labs(title = \"中心極限定理: サンプルサイズによる標本分布の変化\", x = \"標本平均\")\n```\n\n::: {.cell-output-display}\n![](07_sampling_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n$n$ が増えるにつれて、分布は正規分布に近づくだけでなく、その幅（ばらつき）が小さくシャープになっていく。\n\n## 4. 信用の尺度：標準誤差\n\n標本平均の分布のばらつき、つまり「推測の精度」を表す指標が **標準誤差 (Standard Error, SE)** 。\n\n$$SE(\\bar{X}) = \\frac{\\sigma}{\\sqrt{n}}$$\n\nこの式は非常に重要なことを教えてくれる。\n精度を上げる（SEを小さくする）には、サンプルサイズ $n$ を大きくすればいい。ただし、$\\sqrt{n}$ で効いてくるため、精度を2倍にするにはサンプルを4倍にする必要があります。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 理論上のSE\ntrue_se <- sqrt(1/12 / 30)\n\n# シミュレーションのSE（標本平均の標準偏差）\nsim_se <- sd(results %>% filter(size == \"n=30\") %>% pull(means))\n\ncat(\"理論的SE:\", true_se, \"\\n\")\n#> 理論的SE: 0.05270463\ncat(\"シミュレーションSE:\", sim_se, \"\\n\")\n#> シミュレーションSE: 0.05283213\n```\n:::\n\n\n### 標準偏差(SD) vs 標準誤差(SE)\n\nこの2つは混同しやすいので注意してください。\n\n-   **標準偏差 (SD)**: データのばらつき。「個々のデータがどれくらい散らばっているか」。\n-   **標準誤差 (SE)**: 平均値のばらつき。「標本平均が真の平均からどれくらいズレうるか」。\n\n私たちが知りたい「推定の信用度」を表すのは、標準誤差のほうです。\n\n## 課題\n\n1.  **大数の法則**:\n    コイン投げ（表=1, 裏=0）のシミュレーションを行い、試行回数 $n$ を $10$ から $10000$ まで増やしたとき、標本平均が理論値 $0.5$ に収束する様子をグラフで描画してください。\n2.  **標準誤差の性質**:\n    母標準偏差 $\\sigma=10$ の正規分布において、標準誤差を $1$ 以下にするためには、最低何個のサンプルサイズが必要か計算してください。\n\n## 練習問題\n\n### 練習1: 指数分布のCLT\n指数分布（`rexp`）は右に裾が長い歪んだ分布です。この分布からサンプルを抽出しても、標本平均の分布は正規分布に近づくか、シミュレーションで確認してください。\n\n### 練習2: サンプルサイズと精度\n標準誤差の式 $SE = \\sigma / \\sqrt{n}$ に基づき、以下の問いに答えてください。\n\n1. サンプルサイズを100から400に増やすと、標準誤差はどう変化しますか？\n2. 標準誤差を $1/10$ にするためには、サンプルサイズを何倍にする必要がありますか？\n\n### 練習3: 記述統計と推測統計\n手元に $n=100$ のデータがあります。\n- このデータの平均値と標準偏差を計算すること（記述統計）と、\n- このデータの平均値から標準誤差を計算して信頼区間を求めること（推測統計）\nの違いを、自分の言葉で説明してください。\n\n## まとめ\n\n| 概念 | 記号/式 | 意味 |\n|---|---|---|\n| **標本分布** | - | 統計量（平均など）のパラレルワールドでの分布 |\n| **大数の法則** | $n \\to \\infty$ で $\\bar{X} \\to \\mu$ | データが増えれば平均は真の値に近づく |\n| **中心極限定理** | $n$ 大なら $\\bar{X} \\sim N(\\mu, \\sigma^2/n)$ | 平均値の分布は（元が何であれ）正規分布になる |\n| **標準誤差** | $\\sigma / \\sqrt{n}$ | 推定の精度。「平均値のブレ幅」 |\n",
    "supporting": [
      "07_sampling_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
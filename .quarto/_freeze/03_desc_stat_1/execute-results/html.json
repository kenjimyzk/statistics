{
  "hash": "14b54c514a3eba9f30c4ca19d0a58675",
  "result": {
    "engine": "knitr",
    "markdown": "# 第3回 記述統計 (1) 数値要約 {.unnumbered}\n\n![記述統計 (1) 数値要約](figure/03_desc_stat_1/infographic.png)\n\n## 今回の目標\n\n-   データの中心を表す指標（代表値）を理解する。\n-   データのばらつきを表す指標（散布度）を理解する。\n-   Rを使ってこれらの指標を計算する。\n\n## 記述統計とは\n\n記述統計（Descriptive Statistics）とは、データの特徴を数値やグラフで要約・記述する方法です。主に以下の2つの側面からデータを把握します：\n\n1. **中心的傾向（代表値）**: データの「中心」がどこにあるか\n2. **散布度（ばらつき）**: データがどれくらい広がっているか\n\n## 準備\n\n今回も `tidyverse` と `tips` データを使います。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nurl <- \"https://raw.githubusercontent.com/mwaskom/seaborn-data/master/tips.csv\"\ntips <- read_csv(url)\n```\n:::\n\n\n## 代表値：データの中心\n\n### 平均値 (Mean)\n\nすべてのデータを足して、データの個数で割ったものです。\n\n$$\\bar{x} = \\frac{1}{n}\\sum_{i=1}^{n} x_i$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(tips$total_bill)\n#> [1] 19.78594\n```\n:::\n\n\n### 中央値 (Median)\n\nデータを小さい順に並べたときに、ちょうど真ん中にくる値です。\n外れ値（極端に大きい/小さい値）の影響を受けにくいという特徴があります。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmedian(tips$total_bill)\n#> [1] 17.795\n```\n:::\n\n\n### 最頻値 (Mode)\n\nデータの中で最も頻繁に出現する値です。Rには標準で最頻値を求める関数がないため、自分で計算します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# カテゴリ変数の最頻値を確認\ntips %>% \n  count(day) %>% \n  arrange(desc(n))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"day\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Sat\",\"2\":\"87\"},{\"1\":\"Sun\",\"2\":\"76\"},{\"1\":\"Thur\",\"2\":\"62\"},{\"1\":\"Fri\",\"2\":\"19\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### 平均値 vs 中央値：どちらを使うべきか\n\n| 状況 | 推奨される代表値 |\n|------|------------------|\n| 左右対称な分布 | 平均値 |\n| 歪んだ分布（外れ値あり） | 中央値 |\n| 所得や資産のデータ | 中央値 |\n| テストの点数 | 平均値 |\n\n## 散布度：データのばらつき\n\n### 範囲 (Range)\n\n最大値と最小値の差です。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrange(tips$total_bill)  # 最小値と最大値\n#> [1]  3.07 50.81\n\nmax(tips$total_bill) - min(tips$total_bill)  # 範囲\n#> [1] 47.74\n```\n:::\n\n\n### 分散 (Variance)\n\nデータが平均値からどれくらい離れているかを表す指標です。\nRの `var()` 関数は不偏分散を計算します。\n\n$$s^2 = \\frac{1}{n-1}\\sum_{i=1}^{n} (x_i - \\bar{x})^2$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar(tips$total_bill)\n#> [1] 79.25294\n```\n:::\n\n\n### 標準偏差 (Standard Deviation)\n\n分散の平方根をとったものです。元のデータと同じ単位になるので直感的に分かりやすいです。\n\n$$s = \\sqrt{s^2}$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsd(tips$total_bill)\n#> [1] 8.902412\n```\n:::\n\n\n### 変動係数 (Coefficient of Variation)\n\n標準偏差を平均値で割ったもので、単位に依存しないばらつきの指標です。異なる単位のデータのばらつきを比較するときに便利です。\n\n$$CV = \\frac{s}{\\bar{x}} \\times 100\\%$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# チップと支払総額のばらつきを比較\ncv_tip <- sd(tips$tip) / mean(tips$tip) * 100\ncv_bill <- sd(tips$total_bill) / mean(tips$total_bill) * 100\n\ncat(\"チップの変動係数:\", cv_tip, \"%\\n\")\n#> チップの変動係数: 46.14775 %\ncat(\"支払総額の変動係数:\", cv_bill, \"%\\n\")\n#> 支払総額の変動係数: 44.99362 %\n```\n:::\n\n\n### 四分位数 (Quartiles)\n\nデータを小さい順に並べて4等分したときの区切り値です。\n`summary()` 関数を使うと、最小値、第1四分位数、中央値、平均値、第3四分位数、最大値をまとめて表示できます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(tips$total_bill)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>    3.07   13.35   17.80   19.79   24.13   50.81\n```\n:::\n\n\n結果の見方:\n\n-   **Min**: 最小値\n-   **1st Qu**: 第1四分位数（データの下位25%の境界値）\n-   **Median**: 中央値\n-   **Mean**: 平均値\n-   **3rd Qu**: 第3四分位数（データの下位75%の境界値）\n-   **Max**: 最大値\n\n### 四分位範囲 (IQR: Interquartile Range)\n\n第3四分位数と第1四分位数の差を **四分位範囲** と呼びます。\nデータの中央50%がどれくらいの幅に収まっているかを表します。R では `IQR()` 関数で計算できます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIQR(tips$total_bill)\n#> [1] 10.78\n```\n:::\n\n\n四分位範囲は、外れ値の影響を受けにくい散布度の指標として有効です。\n\n## 外れ値の検出\n\n統計分析では、極端に大きい・小さい値（外れ値）がデータに含まれていることがあります。\n外れ値の基準として、以下がよく使われます。\n\n-   第1四分位数 - 1.5 × IQR より小さい値\n-   第3四分位数 + 1.5 × IQR より大きい値\n\n\n::: {.cell}\n\n```{.r .cell-code}\nQ1 <- quantile(tips$total_bill, 0.25)\nQ3 <- quantile(tips$total_bill, 0.75)\nIQR_val <- IQR(tips$total_bill)\n\n# 外れ値の境界\nlower_bound <- Q1 - 1.5 * IQR_val\nupper_bound <- Q3 + 1.5 * IQR_val\n\ncat(\"外れ値の下限:\", lower_bound, \"\\n\")\n#> 外れ値の下限: -2.8225\ncat(\"外れ値の上限:\", upper_bound, \"\\n\")\n#> 外れ値の上限: 40.2975\n\n# 外れ値を持つデータを抽出\ntips %>% \n  filter(total_bill < lower_bound | total_bill > upper_bound) %>% \n  select(total_bill, tip, day, time)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"total_bill\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tip\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"day\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"time\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"48.27\",\"2\":\"6.73\",\"3\":\"Sat\",\"4\":\"Dinner\"},{\"1\":\"44.30\",\"2\":\"2.50\",\"3\":\"Sat\",\"4\":\"Dinner\"},{\"1\":\"41.19\",\"2\":\"5.00\",\"3\":\"Thur\",\"4\":\"Lunch\"},{\"1\":\"48.17\",\"2\":\"5.00\",\"3\":\"Sun\",\"4\":\"Dinner\"},{\"1\":\"50.81\",\"2\":\"10.00\",\"3\":\"Sat\",\"4\":\"Dinner\"},{\"1\":\"45.35\",\"2\":\"3.50\",\"3\":\"Sun\",\"4\":\"Dinner\"},{\"1\":\"40.55\",\"2\":\"3.00\",\"3\":\"Sun\",\"4\":\"Dinner\"},{\"1\":\"43.11\",\"2\":\"5.00\",\"3\":\"Thur\",\"4\":\"Lunch\"},{\"1\":\"48.33\",\"2\":\"9.00\",\"3\":\"Sat\",\"4\":\"Dinner\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## 平均値と中央値の違いを可視化\n\n分布が歪んでいる場合、平均値と中央値はずれます。\nヒストグラムに直線を引いて確認してみましょう。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 平均と中央値を計算 {.unnumbered}\nmean_val <- mean(tips$total_bill)\nmed_val <- median(tips$total_bill)\n\n# プロット {.unnumbered}\nggplot(tips, aes(x = total_bill)) +\n  theme_gray(base_family = \"HiraKakuProN-W3\") +\n  geom_histogram(bins = 30, fill = \"lightgray\", color = \"white\") +\n  geom_vline(xintercept = mean_val, color = \"red\", linetype = \"dashed\", size = 1) +\n  geom_vline(xintercept = med_val, color = \"blue\", linetype = \"solid\", size = 1) +\n  annotate(\"text\", x = mean_val + 5, y = 30, label = \"Mean (Red)\", color = \"red\") +\n  annotate(\"text\", x = med_val - 5, y = 30, label = \"Median (Blue)\", color = \"blue\") +\n  labs(title = \"平均値（赤破線）と中央値（青実線）\")\n```\n\n::: {.cell-output-display}\n![](03_desc_stat_1_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## グループごとの集計\n\n`dplyr` の `group_by()` と `summarize()` を組み合わせると、グループごとの統計量を簡単に計算できます。\n例えば、男女別 (`sex`) の支払総額 (`total_bill`) の平均と標準偏差を求めてみましょう。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntips %>% \n  group_by(sex) %>% \n  summarize(\n    avg_bill = mean(total_bill),\n    sd_bill = sd(total_bill),\n    count = n() # データの個数\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"sex\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"avg_bill\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sd_bill\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"count\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Female\",\"2\":\"18.05690\",\"3\":\"8.009209\",\"4\":\"87\"},{\"1\":\"Male\",\"2\":\"20.74408\",\"3\":\"9.246469\",\"4\":\"157\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## 課題\n\n1.  `tips` データを使って、時間帯 (`time`) ごとのチップ (`tip`) の平均値を計算してください。\n2.  `summary()` 関数を使って、チップ (`tip`) の分布を確認してください。\n\n## 練習問題\n\n### 練習1: 基本的な記述統計\n\n`tips` データの `size`（グループの人数）について以下を計算してください：\n1. 平均値\n2. 中央値\n3. 標準偏差\n4. 最小値と最大値\n\n### 練習2: グループ別の比較\n喫煙者 (`smoker == \"Yes\"`) と非喫煙者 (`smoker == \"No\"`) で、支払総額の平均値と標準偏差を比較してください。\n\n### 練習3: 外れ値の影響\n1. `tips` データに外れ値（`total_bill = 100`）を1つ追加したデータを作成してください\n2. 元のデータと新しいデータで、平均値と中央値を比較してください\n3. どちらの代表値が外れ値の影響を受けやすいですか？\n\n## 記述統計量のまとめ\n\n| 種類 | 指標 | R関数 | 特徴 |\n|------|------|-------|------|\n| 代表値 | 平均値 | `mean()` | 全データを使用、外れ値に敏感 |\n| 代表値 | 中央値 | `median()` | 外れ値に頑健 |\n| 散布度 | 分散 | `var()` | 単位が元の2乗 |\n| 散布度 | 標準偏差 | `sd()` | 元の単位と同じ |\n| 散布度 | 四分位範囲 | `IQR()` | 外れ値に頑健 |\n| 位置 | 四分位数 | `quantile()` | データの位置を表す |\n",
    "supporting": [
      "03_desc_stat_1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
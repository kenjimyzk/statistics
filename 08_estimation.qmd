# 第8回 統計的推定 {.unnumbered}



## 今回の目標

-   点推定と区間推定の違いを理解する。
-   信頼区間の意味を正しく理解する。
-   Rで信頼区間を計算する。

## 点推定 (Point Estimation)

母数（母平均など）を一つの値でピンポイントに推定することです。
例えば、標本平均 $\bar{x}$ は母平均 $\mu$ の点推定値として使われます。

## 区間推定 (Interval Estimation)

母数が含まれるであろう「範囲」を、ある確率（信頼係数）をもって推定することです。
一般的に **95%信頼区間** がよく使われます。

### 信頼区間の意味

「95%の確率で母数がこの区間に入る」というのは少し不正確です。
正しくは、「同じ手順で標本抽出と区間推定を100回繰り返したら、そのうち約95回の区間には母数が含まれる」という意味です。

これをシミュレーションで可視化してみましょう。

```{r}
library(tidyverse)
set.seed(123)

# シミュレーション設定 {.unnumbered}
n_sim <- 100
n_sample <- 30
mu <- 50
sigma <- 10

# 結果を格納するデータフレーム {.unnumbered}
results <- data.frame(id = 1:n_sim, lower = NA, upper = NA, hit = NA)

for (i in 1:n_sim) {
  # 標本抽出
  x <- rnorm(n_sample, mean = mu, sd = sigma)
  # t検定で信頼区間を計算
  test <- t.test(x)
  results$lower[i] <- test$conf.int[1]
  results$upper[i] <- test$conf.int[2]
  # 母平均が含まれているか判定
  results$hit[i] <- (mu >= results$lower[i] & mu <= results$upper[i])
}

# プロット {.unnumbered}
ggplot(results, aes(x = id, ymin = lower, ymax = upper, color = hit)) +
  theme_gray(base_family = "HiraKakuProN-W3") +
  geom_errorbar(width = 0.5) +
  geom_hline(yintercept = mu, linetype = "dashed") +
  labs(title = "95%信頼区間のシミュレーション (100回)", x = "試行回数", y = "推定された区間") +
  scale_color_manual(values = c("TRUE" = "gray", "FALSE" = "red"))
```

## 母平均の信頼区間（母分散が未知の場合）

t分布を使って計算します。Rでは `t.test()` 関数を使うと簡単に計算できます。
`tips` データの `total_bill` の平均値の95%信頼区間を求めてみましょう。

```{r}
library(tidyverse)
url <- "https://raw.githubusercontent.com/mwaskom/seaborn-data/master/tips.csv"
tips <- read_csv(url)

t.test(tips$total_bill)
```

出力結果の `95 percent confidence interval:` の部分を見ます。

```
95 percent confidence interval:
 18.66333 20.90855
```

これは、「支払総額の母平均は、約18.66ドルから20.91ドルの間にあると考えられる」ことを示しています。

## 母比率の信頼区間

「支持率」や「喫煙率」などの割合（比率）の推定には `prop.test()` を使います。
例：100人中60人が賛成した場合の、母集団での賛成率の95%信頼区間。

```{r}
prop.test(x = 60, n = 100)
```

## 課題

1.  `tips` データの `tip`（チップ）について、平均値の99%信頼区間を求めてください。
    （ヒント: `t.test()` の引数に `conf.level = 0.99` を指定します）

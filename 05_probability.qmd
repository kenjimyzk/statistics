# 第5回 確率論の基礎 {.unnumbered}

![確率論の基礎](figure/05_probability/infographic.png)

## 今回の目標

-   確率変数、確率分布の意味を理解する。
-   期待値と分散の定義と意味を理解する。
-   Rを使って期待値を計算してみる。

## なぜ確率を学ぶのか

統計学は「不確実性」を扱う学問です。サンプルから母集団を推測するとき、そこには常に不確実性があります。この不確実性を数学的に扱うために、確率論の知識が必要です。

## 確率の基本

### 確率の定義

確率とは、ある事象が起こる可能性を0から1の間の数値で表したものです。

- 確率 = 0: 絶対に起こらない
- 確率 = 1: 必ず起こる
- 確率 = 0.5: 半々の可能性

### 確率の計算

公正なサイコロを1回振ったとき、特定の目が出る確率：

```{r}
# 1の目が出る確率
1 / 6

# 偶数の目が出る確率
3 / 6
```

## 確率変数と確率分布

-   **確率変数 (Random Variable)**: サイコロの目やコインの裏表のように、とる値が確率的に決まる変数のこと。通常 $X$ や $Y$ などの大文字で表します。
-   **確率分布 (Probability Distribution)**: 確率変数がどのような値をどのような確率でとるかを表したものです。

### 離散型と連続型

- **離散型確率変数**: とりうる値が飛び飛び（例：サイコロの目、コインの裏表）
- **連続型確率変数**: とりうる値が連続的（例：身長、気温）

### 例：サイコロ

サイコロを1回振ったときの出る目を $X$ とすると、$X$ は $\{1, 2, 3, 4, 5, 6\}$ のいずれかの値をとります。
それぞれの目が出る確率は $1/6$ です。

Rで表してみましょう。

```{r}
x <- 1:6
prob <- rep(1/6, 6) # 1/6 を 6回繰り返す

data.frame(x, prob)
```

これをグラフ（確率分布図）にしてみましょう。

```{r}
library(tidyverse)
theme_set(theme_gray(base_family = "HiraKakuProN-W3"))

df <- data.frame(x = factor(x), prob = prob)

ggplot(df, aes(x = x, y = prob)) +
  geom_col(fill = "orange") +
  ylim(0, 0.5) +
  labs(title = "サイコロの確率分布", x = "出る目", y = "確率")
```

## 期待値 (Expected Value)

確率変数の「平均的な値」のことです。$E[X]$ と書きます。
とりうる値に、その確率を掛けて足し合わせることで計算できます。

$$ E[X] = \sum x_i P(X=x_i) $$

サイコロの期待値を計算してみましょう。



3.5 という結果になります。サイコロの目は整数ですが、平均すると3.5になるという意味です。

Rで計算してみましょう。

```{r}
# 期待値の計算
E_X <- sum(x * prob)
E_X
```

### 期待値の性質

期待値には以下のような便利な性質があります。

1.  **定数を足す**: $E[X + c] = E[X] + c$
2.  **定数を掛ける**: $E[cX] = c \cdot E[X]$
3.  **線形性**: $E[aX + bY] = aE[X] + bE[Y]$

## 分散 (Variance)

確率変数の「ばらつき」を表す指標です。$V[X]$ と書きます。
「（値 - 期待値）の2乗」の期待値として定義されます。

$$ V[X] = E[(X - E[X])^2] = \sum (x_i - E[X])^2 P(X=x_i) $$

サイコロの分散を計算してみましょう。

```{r}
# 分散の計算
V_X <- sum((x - E_X)^2 * prob)
V_X

# 標準偏差
sqrt(V_X)
```

### 分散の性質

分散には以下のような便利な性質があります。

1.  **定数を足す**: $V[X + c] = V[X]$（定数を足しても分散は変わらない）
2.  **定数を掛ける**: $V[cX] = c^2 \cdot V[X]$
3.  **別の計算式**: $V[X] = E[X^2] - (E[X])^2$

```{r}
# 別の計算式で確認
E_X2 <- sum(x^2 * prob)  # E[X^2]
E_X2 - E_X^2  # V[X] = E[X^2] - (E[X])^2
```

## 同時確率と条件付き確率

### 同時確率

2つの事象が同時に起こる確率を**同時確率**といいます。

例：2つのサイコロを振って、両方とも6が出る確率

```{r}
# 両方6が出る確率
(1/6) * (1/6)
```

### 条件付き確率

ある事象が起こったという条件のもとで、別の事象が起こる確率を**条件付き確率**といいます。

$$P(A|B) = \frac{P(A \cap B)}{P(B)}$$

### 独立性

事象 $A$ と $B$ が独立であるとは：

$$P(A \cap B) = P(A) \times P(B)$$

が成り立つことをいいます。サイコロを2回振る場合、1回目の結果と2回目の結果は独立です。



## 課題

1.  コインを1回投げて、表が出たら 100円、裏が出たら 0円もらえるギャンブルがあります。
    表が出る確率を 0.5、裏が出る確率を 0.5 とするとき、もらえる金額の期待値を計算してください。
2.  もし表が出る確率が 0.1、裏が出る確率が 0.9 だったら、期待値はどうなりますか？

## 練習問題

### 練習1: サイコロの問題
1. 2つのサイコロを振ったとき、目の合計が7になる確率を計算してください
2. 目の合計の期待値を計算してください

### 練習2: 宝くじの期待値
1等（100万円）が当たる確率が 1/10000、2等（10万円）が当たる確率が 1/1000、ハズレ（0円）がそれ以外の宝くじがあります。この宝くじの期待値を計算してください。

### 練習3: ギャンブルの期待値
コインを3回投げて、表が出た回数 × 100円がもらえるゲームがあります。
1. とりうる値（0円、100円、200円、300円）それぞれの確率を計算してください
2. 期待値を計算してください

## 確率の公式まとめ

| 公式 | 説明 |
|------|------|
| $P(A \cup B) = P(A) + P(B) - P(A \cap B)$ | 加法定理 |
| $P(A \cap B) = P(A) \times P(B\|A)$ | 乗法定理 |
| $P(A\|B) = \frac{P(A \cap B)}{P(B)}$ | 条件付き確率 |
| $E[X] = \sum x_i P(X=x_i)$ | 期待値 |
| $V[X] = E[(X-E[X])^2]$ | 分散 |

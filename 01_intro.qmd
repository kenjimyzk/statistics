# 第1回 RとRStudioの基礎 {.unnumbered}

![RとRStudioの基礎](figure/01_intro/infographic.png)

## はじめに

この講義では、統計解析ソフト **R** と、Rを使いやすくする統合開発環境 **RStudio** の基本的な使い方を学びます。

## RとRStudioとは

-   **R**: 統計解析やデータ分析に特化したプログラミング言語です。無料で使えて、世界中の研究者やデータサイエンティストが利用しています。
-   **RStudio**: Rを便利に使うためのソフトウェア（IDE）です。コードを書く、実行する、グラフを見る、といった作業を一つの画面で行えます。

### なぜRを学ぶのか

1. **無料でオープンソース**: 誰でも無料で使えます
2. **強力な統計機能**: 統計学者が開発したため、統計分析に最適です
3. **豊富なパッケージ**: 世界中のユーザーが作った便利な追加機能が20,000以上あります
4. **再現性**: コードで分析を記録するため、後から同じ分析を再現できます
5. **就職に有利**: データサイエンティストや研究者に必須のスキルです

### RとExcelの違い

| 項目 | R | Excel |
|------|---|-------|
| 価格 | 無料 | 有料 |
| 再現性 | ◎（コードで記録） | △（手作業が多い） |
| 大規模データ | ◎（数百万行も可） | ×（約100万行が限界） |
| 学習コスト | やや高い | 低い |
| 統計分析 | ◎（専門的な分析可能） | △（基本的な分析のみ） |

## RStudioの画面構成

RStudioを開くと、大きく4つのエリア（ペイン）に分かれています。
それぞれの役割を理解することが、効率的な作業の第一歩です。

### 1. Source Editor (左上)
プログラム（スクリプト）を書く場所です。

-   ここに書いたコードは保存できるので、後から再利用できます。
-   複数行のコードを一度に実行したいときにも便利です。
-   `Ctrl + Enter` (Macは `Cmd + Enter`) で、カーソルのある行を実行できます。

### 2. Console (左下)
プログラムを実行し、結果が表示される場所です。

-   コードを1行ずつ試したいときは、直接Consoleに入力してもOKです。
-   ただし、Consoleに書いたコードは保存されないので注意してください。
-   `>` この記号が出ていれば、コマンドの入力待ち状態です。

### 3. Environment / History (右上)
-   **Environment (環境)**: 読み込んだデータや作成した変数が表示されます。データの中身をクリックして確認することもできます。
-   **History (履歴)**: これまでに実行したコマンドの履歴が表示されます。

### 4. Files / Plots / Packages / Help (右下)
-   **Files**: ファイル一覧が表示されます。
-   **Plots**: 作成したグラフが表示されます。
-   **Packages**: インストール済みのパッケージの管理ができます。
-   **Help**: 関数のヘルプを表示できます。`?mean` のように `?` をつけて実行すると、その関数の説明が表示されます。

## 計算してみよう

Console（左下の画面）に数式を入力して `Enter` キーを押すと、計算結果が表示されます。

```{r}
1 + 1
```

```{r}
10 * 5
```

```{r}
(100 - 20) / 4
```

## グラフを描いてみよう

Rはグラフを描く機能も強力です。
試しに、Rに最初から入っている `cars` というデータの散布図を描いてみましょう。

```{r}
library(tidyverse)
theme_set(theme_gray(base_family = "HiraKakuProN-W3"))
ggplot(cars, aes(x = speed, y = dist)) +
  geom_point() +
  labs(title = "車の速度と停止距離")

ggsave("figure/01_intro/cars.png")
```

## 変数（オブジェクト）

計算結果を保存しておく箱のようなものを **変数**（またはオブジェクト）と呼びます。
Rでは `<-` という記号（代入演算子）を使って変数に値を入れます。

```{r}
x <- 10
y <- 5
```

変数の中身を見るには、変数名を入力して実行します。

```{r}
x
```

変数同士の計算もできます。

```{r}
x + y
```

## 関数

Rには便利な機能が **関数** としてたくさん用意されています。
例えば、平方根（ルート）を計算する `sqrt()` 関数を使ってみましょう。

```{r}
sqrt(16)
```

数字の列（ベクトル）を作るには `c()` 関数を使います。

```{r}
scores <- c(80, 90, 75, 60, 95)
scores
```

平均値を計算する `mean()` 関数を使ってみましょう。

```{r}
mean(scores)
```

### 関数の構造

関数は「関数名(引数)」という形で使います。

```{r}
# 複数の引数を持つ関数の例
round(3.14159, digits = 2)  # 小数点以下2桁に丸める
```

### よく使う関数一覧

| 関数 | 説明 | 例 |
|------|------|-----|
| `mean()` | 平均値 | `mean(c(1,2,3))` → 2 |
| `median()` | 中央値 | `median(c(1,2,10))` → 2 |
| `sum()` | 合計 | `sum(c(1,2,3))` → 6 |
| `max()` | 最大値 | `max(c(1,2,3))` → 3 |
| `min()` | 最小値 | `min(c(1,2,3))` → 1 |
| `sqrt()` | 平方根 | `sqrt(16)` → 4 |
| `abs()` | 絶対値 | `abs(-5)` → 5 |
| `round()` | 四捨五入 | `round(3.7)` → 4 |
| `length()` | 要素数 | `length(c(1,2,3))` → 3 |

## よく使う演算子と関数

Rでのデータ分析では、以下の演算子と関数をよく使います。

### 算術演算子
```{r}
# 足し算
2 + 3

# 引き算
10 - 4

# 掛け算
5 * 6

# 割り算
20 / 4

# べき乗
2^3  # 2の3乗

# 割り算の余り
10 %% 3
```

### ベクトルの操作
```{r}
# ベクトルの作成
x <- c(1, 2, 3, 4, 5)

# ベクトル全体に同じ操作を適用
x * 2  # すべての要素を2倍

# ベクトルの要素数
length(x)

# ベクトルの合計
sum(x)

# ベクトルの最大値・最小値
max(x)
min(x)
```

## 実践のヒント

### ヒント1: コメントを活用しよう
コードの前に `#` をつけると、その行はコメント（メモ）になります。
後で見返したときに、何をしているコードなのか分かりやすくなります。

```{r}
# これはコメントです。実行されません。
x <- 10  # 変数xに10を代入
```

### ヒント2: エラーを恐れない
プログラミングではエラーが出るのは当たり前です。
エラーメッセージをよく読んで、何が問題なのか考えてみましょう。
よくあるエラー:

-   **`could not find function`**: 関数名が間違っているか、パッケージを読み込んでいない。
-   **`object not found`**: 変数名が間違っているか、まだ定義していない。
-   **カッコの閉じ忘れ**: `(` や `{` を開いたら、必ず `)` や `}` で閉じる。

### ヒント3: ヘルプの使い方
関数の使い方が分からないときは、`?` をつけて実行してみましょう。

```{r}
#| eval: false
?mean  # mean関数のヘルプを表示
```

## スクリプトの保存

Consoleに書いたコードはRStudioを閉じると消えてしまいます。
後で再利用するために、左上の **Source Editor** にコードを書いて、ファイルとして保存しましょう。

1.  メニューから `File` -> `New File` -> `R Script` を選択。
2.  コードを書く。
3.  `Ctrl + S` (Macは `Cmd + S`) で保存。拡張子は `.R` です。

## 課題

1.  自分の年齢を変数 `age` に代入してください。
2.  `age` に 10 を足して、10年後の年齢を計算してください。
3.  `c()` 関数を使って、好きな数字を3つ入れたベクトル `my_numbers` を作ってください。
4.  `my_numbers` の平均値を求めてください。

## 練習問題

### 練習1: 基本計算
次の計算をRで行ってください。

1. $25 \times 4 + 100$
2. $\sqrt{144}$
3. $2^{10}$（2の10乗）

### 練習2: 変数の操作
1. 変数 `price` に 1500 を代入してください
2. 変数 `quantity` に 3 を代入してください
3. `price * quantity` で合計金額を計算してください

### 練習3: ベクトルの操作
1. 1から10までの数字を含むベクトルを作ってください（ヒント: `1:10` が使えます）
2. そのベクトルの合計を `sum()` で計算してください
3. そのベクトルの平均を `mean()` で計算してください
